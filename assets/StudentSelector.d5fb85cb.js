import{d as e,c as t,a,t as l,n,u as i,s as r,_ as s,b as o,r as c,o as u,e as d,f,g as v,w as m,v as h,h as g,F as p,i as y,j as b,k,l as C,m as w,p as A,q as S,x,y as T}from"./index.03ef747e.js";import{a as F}from"./axios.be23cc29.js";const _=new Uint32Array(65536),j=(e,t)=>{if(e.length<t.length){const a=t;t=e,e=a}return 0===t.length?e.length:e.length<=32?((e,t)=>{const a=e.length,l=t.length,n=1<<a-1;let i=-1,r=0,s=a,o=a;for(;o--;)_[e.charCodeAt(o)]|=1<<o;for(o=0;o<l;o++){let e=_[t.charCodeAt(o)];const a=e|r;e|=(e&i)+i^i,r|=~(e|i),i&=e,r&n&&s++,i&n&&s--,r=r<<1|1,i=i<<1|~(a|r),r&=a}for(o=a;o--;)_[e.charCodeAt(o)]=0;return s})(e,t):((e,t)=>{const a=t.length,l=e.length,n=[],i=[],r=Math.ceil(a/32),s=Math.ceil(l/32);for(let m=0;m<r;m++)i[m]=-1,n[m]=0;let o=0;for(;o<s-1;o++){let r=0,s=-1;const c=32*o,u=Math.min(32,l)+c;for(let t=c;t<u;t++)_[e.charCodeAt(t)]|=1<<t;for(let e=0;e<a;e++){const a=_[t.charCodeAt(e)],l=i[e/32|0]>>>e&1,o=n[e/32|0]>>>e&1,c=a|r,u=((a|o)&s)+s^s|a|o;let d=r|~(u|s),f=s&u;d>>>31^l&&(i[e/32|0]^=1<<e),f>>>31^o&&(n[e/32|0]^=1<<e),d=d<<1|l,f=f<<1|o,s=f|~(c|d),r=d&c}for(let t=c;t<u;t++)_[e.charCodeAt(t)]=0}let c=0,u=-1;const d=32*o,f=Math.min(32,l-d)+d;for(let m=d;m<f;m++)_[e.charCodeAt(m)]|=1<<m;let v=l;for(let m=0;m<a;m++){const e=_[t.charCodeAt(m)],a=i[m/32|0]>>>m&1,r=n[m/32|0]>>>m&1,s=e|c,o=((e|r)&u)+u^u|e|r;let d=c|~(o|u),f=u&o;v+=d>>>l-1&1,v-=f>>>l-1&1,d>>>31^a&&(i[m/32|0]^=1<<m),f>>>31^r&&(n[m/32|0]^=1<<m),d=d<<1|a,f=f<<1|r,u=f|~(s|d),c=d&s}for(let m=d;m<f;m++)_[e.charCodeAt(m)]=0;return v})(e,t)};function I(e,t){let a=!1;const l=new RegExp(/[，。！“”/《》？：；「」{}｜\\"$&+,:;=?@#|'<>.^*()%!\-\s]/g),n=e.toLowerCase().replaceAll(l,""),i=null==t?void 0:t.map((e=>e.toString().toLowerCase().replaceAll(l,"")));return null==i||i.forEach((e=>{var t,l;e&&(1-j(t=n,l=e)/Math.max(t.length,l.length)>.66||n.includes(e)||e.includes(n)||e.startsWith(n)||e.endsWith(n)||""===n)&&(a=!0)})),a}function L(e,t,a){return a.filter((a=>t.includes(a[e])))}const $=["src","alt"],M={class:"name-tag"},E=s(e({__name:"StudentShowbox",props:{studentInfo:{type:Object,required:!0,default:()=>({id:0,familyName:{cn:"",jp:"",en:""},name:{cn:"",jp:"",en:""},nickname:[],rarity:1,club:"",affiliation:"",type:"Main",armorType:"LightArmor",weapon:"AR",availability:{momotalk:!1,story:!1}})}},setup(e){const s=e;const o=t((()=>s.studentInfo.availability.momotalk||s.studentInfo.availability.story));return(t,s)=>{return s[0]||(r(-1),s[0]=a("div",{class:n(["student-container rounded-small",i(o)?"":"unavailable"])},[a("img",{class:"student-avatar",src:(c=e.studentInfo.id,`/image/avatar_students/${c}.webp`),alt:e.studentInfo.name.cn},null,8,$),a("div",M,l(e.studentInfo.name.cn),1)],2),r(1),s[0]);var c}}}),[["__scopeId","data-v-99a966eb"]]),N=e=>(A("data-v-f31bd459"),e=e(),S(),e),z={key:0,class:"loading"},H={class:"spinner"},W={key:1,id:"student-selector-container"},R={class:"filter-banner"},U=["placeholder"],q=["src"],D=[N((()=>a("img",{src:"/assets/filter-options.ac505d64.svg",alt:"Filter options"},null,-1)))],O={class:"student-filter"},P={class:"filter-group"},V=N((()=>a("h2",{class:"filter-label"},"稀有度",-1))),B={class:"filter-options"},G=["onClick"],J={class:"filter-group"},K=N((()=>a("h2",{class:"filter-label"},"学校",-1))),Q={class:"filter-options"},X=["onClick"],Y={class:"filter-group"},Z=N((()=>a("h2",{class:"filter-label"},"战术作用",-1))),ee={class:"filter-options"},te=["onClick"],ae={class:"filter-group"},le=N((()=>a("h2",{class:"filter-label"},"装甲类型",-1))),ne={class:"filter-options"},ie=["onClick"],re={class:"filter-group"},se=N((()=>a("h2",{class:"filter-label"},"社团",-1))),oe={class:"filter-options"},ce=["onClick"],ue={id:"student-list"},de=s(e({__name:"StudentSelector",setup(e){const r=x(),s=o(),A=c(!1),S=c([]),_=c(0),j=t((()=>!/\/archive\/?$/.test(r.path)));F.get("/config/json/students.json",{onDownloadProgress:e=>{_.value=Math.floor(100*(e.loaded||0)/(e.total||1))}}).then((e=>{try{S.value=e.data.sort(((e,t)=>e.name.cn.localeCompare(t.name.cn,"zh-Hans-CN",{sensitivity:"accent"}))).sort(((e,t)=>(e.availability.story||e.availability.momotalk)&&(t.availability.story||t.availability.momotalk)?0:e.availability.story||e.availability.momotalk?-1:t.availability.story||t.availability.momotalk?1:0))}catch(t){S.value=e.data}A.value=!0})).catch((e=>{console.log(e)}));const $=t((()=>S.value.map((e=>({id:e.id,allNames:[e.name.cn,e.name.jp,e.name.en,...e.nickname]})))));function M(e,t=!0){const a=[];if(S.value.forEach((t=>{a.includes(t[e])||a.push(t[e])})),t)try{return a.sort(((e,t)=>e.toString().localeCompare(t.toString(),"zh-Hans-CN",{sensitivity:"accent"})))}catch(l){return a}return a}const N=[{string:"LightArmor",name:"轻装甲",order:1},{string:"HeavyArmor",name:"重装甲",order:2},{string:"Unarmed",name:"神秘装甲",order:3}];const de=t((()=>M("rarity",!1))),fe=t((()=>M("club"))),ve=t((()=>M("affiliation"))),me=t((()=>M("type",!1))),he=t((()=>M("armorType",!1).sort(((e,t)=>function(e,t){const a=N.find((t=>t.string===e))||{name:"0"},l=N.find((e=>e.string===t))||{name:"1"};return a.name.localeCompare(l.name,"zh-Hans-CN",{sensitivity:"accent"})}(e,t))))),ge=c(""),pe=t((()=>({searchString:ge.value,rarity:s.getRarityFilter,club:s.getClubFilter,affiliation:s.getAffiliationFilter,type:s.getTypeFilter,armorType:s.getArmorTypeFilter}))),ye=t((()=>0===pe.value.rarity.length&&0===pe.value.club.length&&0===pe.value.affiliation.length&&0===pe.value.type.length&&0===pe.value.armorType.length));function be(e,t){return pe.value[e].includes(t)?"active":""}function ke(e,t){pe.value[e].includes(t)?pe.value[e]=pe.value[e].filter((e=>e!==t)):pe.value[e].push(t),s.setStudentFilters(pe.value)}const Ce=t((()=>function(e,t,a){if(""===e.searchString&&0===e.rarity.length&&0===e.club.length&&0===e.affiliation.length&&0===e.type.length&&0===e.armorType.length)return a.map((e=>e.id));let l=a;if(e.searchString){const n=[];a.forEach((a=>{var l;I(e.searchString,null==(l=t.find((e=>e.id===a.id)))?void 0:l.allNames)&&n.push(a)})),l=n}return 0!==e.rarity.length&&(l=L("rarity",e.rarity,l)),0!==e.club.length&&(l=L("club",e.club,l)),0!==e.affiliation.length&&(l=L("affiliation",e.affiliation,l)),0!==e.type.length&&(l=L("type",e.type,l)),0!==e.armorType.length&&(l=L("armorType",e.armorType,l)),l.map((e=>e.id))}(pe.value,$.value,S.value)));function we(e){e.target.select()}const Ae=c(!0);function Se(){Ae.value=window.innerWidth>768}return u((()=>{window.innerWidth<=768&&(Ae.value=!1),window.addEventListener("resize",Se)})),d((()=>{window.removeEventListener("resize",Se)})),(e,t)=>{const r=T("router-link"),o=T("router-view");return k(),f(p,null,[A.value?v("",!0):(k(),f("div",z,[a("div",H,[a("span",null,l(_.value)+"%",1)])])),A.value&&!i(j)?(k(),f("div",W,[a("div",R,[m(a("input",{type:"text",id:"name-filter",placeholder:ge.value?"":"在学生姓名/黑话内搜索…","onUpdate:modelValue":t[0]||(t[0]=e=>ge.value=e),onFocus:we,autocomplete:"off"},null,40,U),[[h,ge.value]]),i(ye)?v("",!0):(k(),f("div",{key:0,class:"clear-filter-icon",onClick:t[1]||(t[1]=(...e)=>i(s).clearStudentFilters&&i(s).clearStudentFilters(...e))},[a("img",{src:i(ye)?"/src/assets/filter.svg":"/src/assets/clear-filter.svg",alt:"filter"},null,8,q)])),a("div",{class:"filter-options-icon-mobile rounded-small",onClick:t[2]||(t[2]=e=>Ae.value=!Ae.value)},D)]),m(a("div",O,[a("div",P,[V,a("div",B,[(k(!0),f(p,null,y(i(de),(e=>(k(),f("div",{class:n(["filter-tag rounded-small",be("rarity",e)]),role:"checkbox",key:e,onClick:t=>ke("rarity",e)}," ★ "+l(e),11,G)))),128))])]),a("div",J,[K,a("div",Q,[(k(!0),f(p,null,y(i(ve),(e=>(k(),f("div",{class:n(["filter-tag rounded-small",be("affiliation",e)]),role:"checkbox",key:e,onClick:t=>ke("affiliation",e)},l(e),11,X)))),128))])]),a("div",Y,[Z,a("div",ee,[(k(!0),f(p,null,y(i(me),(e=>(k(),f("div",{class:n(["filter-tag tactic-type rounded-small",`${e.toString().toLowerCase()} ${be("type",e)}`]),role:"checkbox",key:e,onClick:t=>ke("type",e)},l(e),11,te)))),128))])]),a("div",ae,[le,a("div",ne,[(k(!0),f(p,null,y(i(he),(e=>{var t;return k(),f("div",{class:n(["filter-tag armor-type rounded-small",`${e.toString().toLowerCase()} ${be("armorType",e)}`]),role:"checkbox",key:e,onClick:t=>ke("armorType",e)},l((null==(t=N.find((t=>e===t.string)))?void 0:t.name)||e),11,ie)})),128))])]),a("div",re,[se,a("div",oe,[(k(!0),f(p,null,y(i(fe),(e=>(k(),f("div",{class:n(["filter-tag rounded-small",be("club",e)]),role:"checkbox",key:e,onClick:t=>ke("club",e)},l(e),11,ce)))),128))])])],512),[[g,Ae.value]]),a("div",ue,[(k(!0),f(p,null,y(S.value,(e=>m((k(),b(r,{class:"student-showcase rounded-small",key:e.id,to:`/archive/${e.id}/momotalk`},{default:C((()=>[w(E,{"student-info":e},null,8,["student-info"])])),_:2},1032,["to"])),[[g,i(Ce).includes(e.id)]]))),128))])])):v("",!0),i(j)?(k(),b(o,{key:2})):v("",!0)],64)}}}),[["__scopeId","data-v-f31bd459"]]);export{de as default};
