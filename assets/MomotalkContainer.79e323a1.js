import{u as e,a}from"./students.a666aee7.js";import{d as s,c as t,o as n,a as l,b as o,t as i,e as r,n as d,A as u,p as c,q as g,_ as v,u as p,r as m,h as M,w as I,i as h,F as f,j as C,k,s as T,m as b}from"./index.0b194b60.js";const x=["onKeydown"],y={class:"section-title"},w={class:"ordered-list"},G={class:"title"},N=[(e=>(c("data-v-28b66cb1"),e=e(),g(),e))((()=>o("path",{fill:"#344A6E",d:"M225.9 354.7c-8.1 0-16.2-3.1-22.4-9.3L9.3 151.2c-12.4-12.4-12.4-32.4 0-44.8C21.7 94 41.7 94 54 106.4l171.9 171.9 171.9-171.9c12.4-12.4 32.4-12.4 44.7 0 12.4 12.4 12.4 32.4 0 44.8L248.3 345.4c-6.2 6.2-14.3 9.3-22.4 9.3z"},null,-1)))],S=v(s({__name:"StudentArchiveTitle",props:{title:{type:Object,required:!0},index:{type:Number,required:!1},language:{type:String,required:!0},isActive:{type:Boolean,required:!1}},emits:["clicked"],setup(e,{emit:a}){const s=e;function c(){a("clicked")}const g={zh:"TextCn",tw:"TextTw",en:"TextEn",jp:"TextJp",kr:"TextKr",th:"TextTh"},v=t((()=>Reflect.get(s.title,Reflect.get(g,s.language))));function p(){for(const e in g){const a=Reflect.get(s.title,Reflect.get(g,e));if(a)return a}return"NoFallbackText"}return(a,s)=>{var t;return n(),l("div",{class:"archive-title rounded-small",tabindex:"0",onClick:c,onKeydown:[u(c,["enter"]),u(c,["space"])]},[o("p",y,[o("span",w,i(`${parseInt((null==(t=e.index)?void 0:t.toString())||"0")+1}`.padStart(2,"0")),1),o("span",G,i(r(v)||`!!FallBack: ${p()}`),1)]),(n(),l("svg",{class:d(["navigate-arrow",e.isActive?"open":""]),xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 451.8 451.8"},N,2))],40,x)}}}),[["__scopeId","data-v-28b66cb1"]]),F=e=>(c("data-v-0961b327"),e=e(),g(),e),_={key:0,class:"student-reply"},P={class:"message-content-wrap rounded-small"},R={key:0,class:"typing-indicator"},A=[F((()=>o("span",{class:"dot-1"},"·",-1))),F((()=>o("span",{class:"dot-2"},"·",-1))),F((()=>o("span",{class:"dot-3"},"·",-1)))],j={class:"message-content"},K={key:0},E=["src"],V={key:1,class:"user-reply rounded-small"},z=F((()=>o("div",{class:"user-reply-banner"},[o("span",null,"回复")],-1))),J={class:"select-options flex-vertical"},H=["onClick"],W={key:0,class:"momotalk-unit"},q={class:"favor-schedule-unit rounded-small"},$=F((()=>o("div",{class:"favor-schedule-banner"},[o("span",null,"羁绊事件")],-1))),B={role:"button",class:"favor-schedule-button rounded-small shadow-near"},L=v(s({__name:"MomoTalkComponent",props:{message:Object},emits:["userSelect"],setup(a,{emit:s}){var u,c,g,v;const k=a,T=p(),b=e(),x=t((()=>T.getLang.replace("cn","zh"))),y=(null==(u=k.message)?void 0:u.CharacterId)||1e4,w=b.getStudentById(y),G=t((()=>(null==w?void 0:w.name[x.value])||"")),N=(null==(c=k.message)?void 0:c.MessageCondition)||"None",S=(null==(g=k.message)?void 0:g.MessageType)||"Text",F=`/image/avatar_students/${y}.webp`,L=m(-1),O=m(!1),U=m(!1),D=(null==(v=k.message)?void 0:v.FeedbackTimeMillisec)||1e3;function Q(e){if(e){return`/image/ScenarioImage/${e.split("/").pop()}.png`}return""}setTimeout((()=>{O.value=!0}),D),setTimeout((()=>{U.value=!0}),D+500);const X={zh:"MessageCN",tw:"MessageTW",en:"MessageEN",jp:"MessageJP",kr:"MessageKR",th:"MessageTH"};function Y(e){if(e){let t=(a=x.value,s=e,function(e){return e?e.replaceAll(/\[\/?ruby=?.*?]/gi,""):""}(Reflect.get(s,Reflect.get(X,a))));return t||`!Fallback:${function(e){for(const a in X){const s=Reflect.get(e,Reflect.get(X,a));if(s)return s}return"NoFallbackText"}(e)}`}var a,s;return""}return(e,t)=>{var u,c,g,v,p,m;return n(),l(f,null,[o("div",{class:d(["momotalk-unit",(null==(u=a.message)?void 0:u.avatar)||"Answer"===r(N)?"":"condensed"])},["Answer"!==r(N)?(n(),l("div",_,[o("img",{class:d(["student-avatar",(null==(c=a.message)?void 0:c.avatar)?"":"hidden"]),src:F},null,2),o("div",P,[O.value?M("",!0):(n(),l("div",R,A)),I(o("div",j,["Image"!==r(S)?(n(),l("span",K,i(Y(a.message)),1)):(n(),l("img",{key:1,src:Q(null==(g=a.message)?void 0:g.ImagePath)},null,8,E))],512),[[h,O.value]])])])):M("",!0),"Answer"===r(N)?(n(),l("div",V,[z,o("div",J,[(n(!0),l(f,null,C(null==(p=null==(v=a.message)?void 0:v.options)?void 0:p.content,((e,t)=>(n(),l("div",{role:"button",class:d(["rounded-small shadow-near",t===L.value?"selected":""]),key:t,onClick:n=>{var l,o,i,r;return o=t,i=null==(l=a.message)?void 0:l.Id,r=e.NextGroupId,L.value=o,void s("userSelect",i||0,r)}},i(Y(e)),11,H)))),128))])])):M("",!0)],2),0!==(null==(m=a.message)?void 0:m.FavorScheduleId)&&U.value?(n(),l("div",W,[o("div",q,[$,o("div",B," 前往"+i(r(G))+"的羁绊事件 ",1)])])):M("",!0)],64)}}}),[["__scopeId","data-v-0961b327"]]),O=e=>(c("data-v-684f5998"),e=e(),g(),e),U={key:0,class:"optionChange"},D={class:"momotalk-main-interface flex-vertical"},Q={class:"momotalk-banner flex-horizontal center"},X=O((()=>o("svg",{xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",id:"Layer_2_00000033347787382183846980000016369978894466167968_",x:"0",y:"0",viewBox:"0 0 512 477.9"},[o("path",{d:"M101.8 396.4c-53.3 0-98.4 53.8-101.8 79.5 81.4 7.9 196.1-6.8 252.1-65-74.7 13.5-135.9-5.2-150.3-14.5zM281.4 412.5c55.1 73.3 137.7 58.5 230.5 63.3 3.5-42.1-73.2-80.9-103.9-82.2-39.9 28.5-123.3 19.5-126.6 18.9z"}),o("path",{d:"M256.4 0C136.8 45 31.5 151.4 31.5 259.4c0 85 68.4 153.9 195.3 137.3 3.9-.5 7.6-1.1 11.2-1.7-1.1-.4-2.1-.9-2.9-1.3-19.4-9.8-53.4-56.7-39-112.6 1.4 59.3 39.7 102.6 57.1 111 2.7 1.3 11.9 4.6 25.5 6.7 51.9 8 164.9 4.7 187.9-116.7C498.9 111.4 256.4 0 256.4 0z"})],-1))),Y={class:"momotalk-title-text"},Z=O((()=>o("span",{class:"title"},"MomoTalk",-1))),ee={class:"credit"},ae=O((()=>o("span",null,"translated by ",-1))),se={key:0},te=O((()=>o("a",{href:"https://space.bilibili.com/37507923",target:"_blank"}," 碧蓝档案资讯站 ",-1))),ne={class:"messages"},le=v(s({__name:"MomotalkViewer",props:{messageGroup:Number,translate:{type:String,default:"",required:!1},content:Object},setup(e){const a=e;let s=m(0);const t=m([]);async function r(e,a){var n;if(s.value!=a)return;const l=u(e),o=l[0];if(o){if("Answer"==o.MessageCondition){const l=[],i=u(e),r=(null==(n=i.find((e=>0!==e.FavorScheduleId)))?void 0:n.FavorScheduleId)||0;for(const e of i)l.push({MessageCN:e.MessageCN,MessageJP:e.MessageJP,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW,NextGroupId:e.NextGroupId});if(s.value!=a)return;return t.value.push({avatar:!1,MessageGroupId:o.MessageGroupId,Id:o.Id,CharacterId:o.CharacterId,ConditionValue:0,PreConditionGroupId:0,FavorScheduleId:r,NextGroupId:0,FeedbackTimeMillisec:0,MessageCondition:"Answer",options:{current:-1,content:l},MessageType:"Text",ImagePath:""}),void(await d(-1e3))}if(s.value==a){t.value.push({avatar:!0,MessageGroupId:o.MessageGroupId,Id:o.Id,CharacterId:o.CharacterId,ConditionValue:o.ConditionValue,PreConditionGroupId:o.PreConditionGroupId,FavorScheduleId:o.FavorScheduleId,NextGroupId:o.NextGroupId,FeedbackTimeMillisec:o.FeedbackTimeMillisec,MessageCondition:o.MessageCondition,MessageType:o.MessageType,ImagePath:o.ImagePath,MessageJP:o.MessageJP,MessageCN:o.MessageCN,MessageEN:o.MessageEN,MessageKR:o.MessageKR,MessageTH:o.MessageTH,MessageTW:o.MessageTW}),await d(o.FeedbackTimeMillisec||1500);for(let e of l.slice(1)){if(s.value!=a)return;t.value.push({avatar:!1,MessageGroupId:e.MessageGroupId,Id:e.Id,CharacterId:e.CharacterId,ConditionValue:e.ConditionValue,PreConditionGroupId:e.PreConditionGroupId,FavorScheduleId:e.FavorScheduleId,NextGroupId:e.NextGroupId,FeedbackTimeMillisec:e.FeedbackTimeMillisec,MessageCondition:e.MessageCondition,MessageType:e.MessageType,ImagePath:e.ImagePath,MessageJP:e.MessageJP,MessageCN:e.MessageCN,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW}),await d(e.FeedbackTimeMillisec||1500)}await r(o.NextGroupId,a)}}}function d(e){return new Promise((a=>setTimeout(a,e+1e3)))}function u(e){var s;return null==(s=a.content)?void 0:s.filter((a=>a.MessageGroupId==e))}const c=m(!1);function g(e,a){const n=t.value.findIndex((a=>a.Id===e));t.value=t.value.slice(0,n+1),s.value++,r(a,s.value)}return r(a.content[0].MessageGroupId,0),(a,s)=>(n(),l(f,null,[c.value?(n(),l("div",U)):M("",!0),o("div",null,i(e.messageGroup),1),o("div",D,[o("div",Q,[X,o("div",Y,[Z,o("div",ee,[ae,e.translate?(n(),l("span",se,i(e.translate)+"@",1)):M("",!0),te])])]),o("div",ne,[(n(!0),l(f,null,C(t.value,((e,a)=>(n(),k(L,{key:a,message:e,onUserSelect:g},null,8,["message"])))),128))])])],64))}}),[["__scopeId","data-v-684f5998"]]),oe={class:"momotalk-component-container"},ie=v(s({__name:"MomotalkContainer",setup(e){const s=p(),o=t((()=>s.getLang)),i=m({CharacterId:0,translate:"",title:[],content:[],splitMomotalk:[]}),d=m([]),u=T();return a.get(`/config/json/momotalk/${u.params.id}.json`).then((e=>{const a=e.data;i.value.CharacterId=a.CharacterId,i.value.translate=a.translate,i.value.title=a.title,i.value.content=a.content,i.value.splitMomotalk=function(e){const a=[];for(const s of e)0===a.length?a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]}):0===s.ConditionValue?a[a.length-1].splitMomotalkContent.push(s):a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]});return a}(a.content)})),(e,a)=>(n(),l("div",oe,[(n(!0),l(f,null,C(i.value.title,((e,a)=>{return n(),l("div",{class:"momotalks-view-container flex-vertical",key:a},[b(S,{onClicked:e=>function(e){d.value.includes(e)?d.value=d.value.filter((a=>a!==e)):d.value.push(e)}(a),title:e,language:r(o),index:a,"is-active":d.value.includes(a)},null,8,["onClicked","title","language","index","is-active"]),d.value.includes(a)?(n(),k(le,{key:0,messageGroup:e.GroupId,translate:i.value.translate,content:(s=e.GroupId,null==(t=i.value.splitMomotalk.find((e=>e.FavorScheduleId===s)))?void 0:t.splitMomotalkContent)},null,8,["messageGroup","translate","content"])):M("",!0)]);var s,t})),128))]))}}),[["__scopeId","data-v-2b42fa9c"]]);export{ie as default};
