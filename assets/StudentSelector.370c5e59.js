import{d as e,c as t,a,t as l,n,u as i,s as r,_ as o,b as s,r as c,o as u,e as d,f,g as v,w as m,v as h,h as g,F as p,i as y,j as b,k,l as C,m as w,p as A,q as S,x,y as T}from"./index.b72419d9.js";import{a as F}from"./axios.be23cc29.js";const _=new Uint32Array(65536),j=(e,t)=>{if(e.length<t.length){const a=t;t=e,e=a}return 0===t.length?e.length:e.length<=32?((e,t)=>{const a=e.length,l=t.length,n=1<<a-1;let i=-1,r=0,o=a,s=a;for(;s--;)_[e.charCodeAt(s)]|=1<<s;for(s=0;s<l;s++){let e=_[t.charCodeAt(s)];const a=e|r;e|=(e&i)+i^i,r|=~(e|i),i&=e,r&n&&o++,i&n&&o--,r=r<<1|1,i=i<<1|~(a|r),r&=a}for(s=a;s--;)_[e.charCodeAt(s)]=0;return o})(e,t):((e,t)=>{const a=t.length,l=e.length,n=[],i=[],r=Math.ceil(a/32),o=Math.ceil(l/32);for(let m=0;m<r;m++)i[m]=-1,n[m]=0;let s=0;for(;s<o-1;s++){let r=0,o=-1;const c=32*s,u=Math.min(32,l)+c;for(let t=c;t<u;t++)_[e.charCodeAt(t)]|=1<<t;for(let e=0;e<a;e++){const a=_[t.charCodeAt(e)],l=i[e/32|0]>>>e&1,s=n[e/32|0]>>>e&1,c=a|r,u=((a|s)&o)+o^o|a|s;let d=r|~(u|o),f=o&u;d>>>31^l&&(i[e/32|0]^=1<<e),f>>>31^s&&(n[e/32|0]^=1<<e),d=d<<1|l,f=f<<1|s,o=f|~(c|d),r=d&c}for(let t=c;t<u;t++)_[e.charCodeAt(t)]=0}let c=0,u=-1;const d=32*s,f=Math.min(32,l-d)+d;for(let m=d;m<f;m++)_[e.charCodeAt(m)]|=1<<m;let v=l;for(let m=0;m<a;m++){const e=_[t.charCodeAt(m)],a=i[m/32|0]>>>m&1,r=n[m/32|0]>>>m&1,o=e|c,s=((e|r)&u)+u^u|e|r;let d=c|~(s|u),f=u&s;v+=d>>>l-1&1,v-=f>>>l-1&1,d>>>31^a&&(i[m/32|0]^=1<<m),f>>>31^r&&(n[m/32|0]^=1<<m),d=d<<1|a,f=f<<1|r,u=f|~(o|d),c=d&o}for(let m=d;m<f;m++)_[e.charCodeAt(m)]=0;return v})(e,t)};function I(e,t){let a=!1;const l=new RegExp(/[，。！“”/《》？：；「」{}｜\\"$&+,:;=?@#|'<>.^*()%!\-\s]/g),n=e.toLowerCase().replaceAll(l,""),i=null==t?void 0:t.map((e=>e.toString().toLowerCase().replaceAll(l,"")));return null==i||i.forEach((e=>{var t,l;e&&(1-j(t=n,l=e)/Math.max(t.length,l.length)>.66||n.includes(e)||e.includes(n)||e.startsWith(n)||e.endsWith(n)||""===n)&&(a=!0)})),a}function L(e,t,a){return a.filter((a=>t.includes(a[e])))}const $=["src","alt"],M={class:"name-tag"},E=o(e({__name:"StudentShowbox",props:{studentInfo:{type:Object,required:!0,default:()=>({id:0,familyName:{cn:"",jp:"",en:""},name:{cn:"",jp:"",en:""},nickname:[],rarity:1,club:"",affiliation:"",type:"Main",armorType:"LightArmor",weapon:"AR",availability:{momotalk:!1,story:!1}})}},setup(e){const o=e;const s=t((()=>o.studentInfo.availability.momotalk||o.studentInfo.availability.story));return(t,o)=>{return o[0]||(r(-1),o[0]=a("div",{class:n(["student-container rounded-small",i(s)?"":"unavailable"])},[a("img",{class:"student-avatar",src:(c=e.studentInfo.id,`/image/avatar_students/${c}.webp`),alt:e.studentInfo.name.cn},null,8,$),a("div",M,l(e.studentInfo.name.cn),1)],2),r(1),o[0]);var c}}}),[["__scopeId","data-v-99a966eb"]]),N=e=>(A("data-v-659259b8"),e=e(),S(),e),z={key:0,class:"loading"},H={class:"spinner"},W={key:1,id:"student-selector-container"},R={class:"filter-banner"},U=["placeholder"],q={src:"/assets/filter.33ed4045.svg",alt:"filter"},D={src:"/assets/clear-filter.e675c05c.svg",alt:"filter"},O=[N((()=>a("img",{src:"/assets/filter-options.ac505d64.svg",alt:"Filter options"},null,-1)))],P={class:"student-filter"},V={class:"filter-group"},B=N((()=>a("h2",{class:"filter-label"},"稀有度",-1))),G={class:"filter-options"},J=["onClick"],K={class:"filter-group"},Q=N((()=>a("h2",{class:"filter-label"},"学校",-1))),X={class:"filter-options"},Y=["onClick"],Z={class:"filter-group"},ee=N((()=>a("h2",{class:"filter-label"},"战术作用",-1))),te={class:"filter-options"},ae=["onClick"],le={class:"filter-group"},ne=N((()=>a("h2",{class:"filter-label"},"装甲类型",-1))),ie={class:"filter-options"},re=["onClick"],oe={class:"filter-group"},se=N((()=>a("h2",{class:"filter-label"},"社团",-1))),ce={class:"filter-options"},ue=["onClick"],de={id:"student-list"},fe=o(e({__name:"StudentSelector",setup(e){const r=x(),o=s(),A=c(!1),S=c([]),_=c(0),j=t((()=>!/\/archive\/?$/.test(r.path)));F.get("/config/json/students.json",{onDownloadProgress:e=>{_.value=Math.floor(100*(e.loaded||0)/(e.total||1))}}).then((e=>{try{S.value=e.data.sort(((e,t)=>e.name.cn.localeCompare(t.name.cn,"zh-Hans-CN",{sensitivity:"accent"}))).sort(((e,t)=>(e.availability.story||e.availability.momotalk)&&(t.availability.story||t.availability.momotalk)?0:e.availability.story||e.availability.momotalk?-1:t.availability.story||t.availability.momotalk?1:0))}catch(t){S.value=e.data}A.value=!0})).catch((e=>{console.log(e)}));const $=t((()=>S.value.map((e=>({id:e.id,allNames:[e.name.cn,e.name.jp,e.name.en,...e.nickname]})))));function M(e,t=!0){const a=[];if(S.value.forEach((t=>{a.includes(t[e])||a.push(t[e])})),t)try{return a.sort(((e,t)=>e.toString().localeCompare(t.toString(),"zh-Hans-CN",{sensitivity:"accent"})))}catch(l){return a}return a}const N=[{string:"LightArmor",name:"轻装甲",order:1},{string:"HeavyArmor",name:"重装甲",order:2},{string:"Unarmed",name:"神秘装甲",order:3}];const fe=t((()=>M("rarity",!1))),ve=t((()=>M("club"))),me=t((()=>M("affiliation"))),he=t((()=>M("type",!1))),ge=t((()=>M("armorType",!1).sort(((e,t)=>function(e,t){const a=N.find((t=>t.string===e))||{name:"0"},l=N.find((e=>e.string===t))||{name:"1"};return a.name.localeCompare(l.name,"zh-Hans-CN",{sensitivity:"accent"})}(e,t))))),pe=c(""),ye=t((()=>({searchString:pe.value,rarity:o.getRarityFilter,club:o.getClubFilter,affiliation:o.getAffiliationFilter,type:o.getTypeFilter,armorType:o.getArmorTypeFilter}))),be=t((()=>0===ye.value.rarity.length&&0===ye.value.club.length&&0===ye.value.affiliation.length&&0===ye.value.type.length&&0===ye.value.armorType.length));function ke(e,t){return ye.value[e].includes(t)?"active":""}function Ce(e,t){ye.value[e].includes(t)?ye.value[e]=ye.value[e].filter((e=>e!==t)):ye.value[e].push(t),o.setStudentFilters(ye.value)}const we=t((()=>function(e,t,a){if(""===e.searchString&&0===e.rarity.length&&0===e.club.length&&0===e.affiliation.length&&0===e.type.length&&0===e.armorType.length)return a.map((e=>e.id));let l=a;if(e.searchString){const n=[];a.forEach((a=>{var l;I(e.searchString,null==(l=t.find((e=>e.id===a.id)))?void 0:l.allNames)&&n.push(a)})),l=n}return 0!==e.rarity.length&&(l=L("rarity",e.rarity,l)),0!==e.club.length&&(l=L("club",e.club,l)),0!==e.affiliation.length&&(l=L("affiliation",e.affiliation,l)),0!==e.type.length&&(l=L("type",e.type,l)),0!==e.armorType.length&&(l=L("armorType",e.armorType,l)),l.map((e=>e.id))}(ye.value,$.value,S.value)));function Ae(e){e.target.select()}const Se=c(!0);function xe(){Se.value=window.innerWidth>768}return u((()=>{window.innerWidth<=768&&(Se.value=!1),window.addEventListener("resize",xe)})),d((()=>{window.removeEventListener("resize",xe)})),(e,t)=>{const r=T("router-link"),s=T("router-view");return k(),f(p,null,[A.value?v("",!0):(k(),f("div",z,[a("div",H,[a("span",null,l(_.value)+"%",1)])])),A.value&&!i(j)?(k(),f("div",W,[a("div",R,[m(a("input",{type:"text",id:"name-filter",placeholder:pe.value?"":"在学生姓名/黑话内搜索…","onUpdate:modelValue":t[0]||(t[0]=e=>pe.value=e),onFocus:Ae,autocomplete:"off"},null,40,U),[[h,pe.value]]),i(be)?v("",!0):(k(),f("div",{key:0,class:"clear-filter-icon",onClick:t[1]||(t[1]=(...e)=>i(o).clearStudentFilters&&i(o).clearStudentFilters(...e))},[m(a("img",q,null,512),[[g,i(be)]]),m(a("img",D,null,512),[[g,!i(be)]])])),a("div",{class:"filter-options-icon-mobile rounded-small",onClick:t[2]||(t[2]=e=>Se.value=!Se.value)},O)]),m(a("div",P,[a("div",V,[B,a("div",G,[(k(!0),f(p,null,y(i(fe),(e=>(k(),f("div",{class:n(["filter-tag rounded-small",ke("rarity",e)]),role:"checkbox",key:e,onClick:t=>Ce("rarity",e)}," ★ "+l(e),11,J)))),128))])]),a("div",K,[Q,a("div",X,[(k(!0),f(p,null,y(i(me),(e=>(k(),f("div",{class:n(["filter-tag rounded-small",ke("affiliation",e)]),role:"checkbox",key:e,onClick:t=>Ce("affiliation",e)},l(e),11,Y)))),128))])]),a("div",Z,[ee,a("div",te,[(k(!0),f(p,null,y(i(he),(e=>(k(),f("div",{class:n(["filter-tag tactic-type rounded-small",`${e.toString().toLowerCase()} ${ke("type",e)}`]),role:"checkbox",key:e,onClick:t=>Ce("type",e)},l(e),11,ae)))),128))])]),a("div",le,[ne,a("div",ie,[(k(!0),f(p,null,y(i(ge),(e=>{var t;return k(),f("div",{class:n(["filter-tag armor-type rounded-small",`${e.toString().toLowerCase()} ${ke("armorType",e)}`]),role:"checkbox",key:e,onClick:t=>Ce("armorType",e)},l((null==(t=N.find((t=>e===t.string)))?void 0:t.name)||e),11,re)})),128))])]),a("div",oe,[se,a("div",ce,[(k(!0),f(p,null,y(i(ve),(e=>(k(),f("div",{class:n(["filter-tag rounded-small",ke("club",e)]),role:"checkbox",key:e,onClick:t=>Ce("club",e)},l(e),11,ue)))),128))])])],512),[[g,Se.value]]),a("div",de,[(k(!0),f(p,null,y(S.value,(e=>m((k(),b(r,{class:"student-showcase rounded-small",key:e.id,to:`/archive/${e.id}/momotalk`},{default:C((()=>[w(E,{"student-info":e},null,8,["student-info"])])),_:2},1032,["to"])),[[g,i(we).includes(e.id)]]))),128))])])):v("",!0),i(j)?(k(),b(s,{key:2})):v("",!0)],64)}}}),[["__scopeId","data-v-659259b8"]]);export{fe as default};
