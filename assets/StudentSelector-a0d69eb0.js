import{d as e,u as t,c as l,o as a,a as n,b as r,t as i,e as s,_ as o,r as c,f as u,g as d,h as f,i as v,w as h,v as p,j as g,F as m,k as y,n as b,l as C,m as k,p as S,q as w,s as x,x as A}from"./index-eba88e47.js";import{a as T,E as F}from"./ErrorScreen-2cafd65f.js";import{u as _}from"./students-82a2e9e5.js";const j=new Uint32Array(65536),E=(e,t)=>{if(e.length<t.length){const l=t;t=e,e=l}return 0===t.length?e.length:e.length<=32?((e,t)=>{const l=e.length,a=t.length,n=1<<l-1;let r=-1,i=0,s=l,o=l;for(;o--;)j[e.charCodeAt(o)]|=1<<o;for(o=0;o<a;o++){let e=j[t.charCodeAt(o)];const l=e|i;e|=(e&r)+r^r,i|=~(e|r),r&=e,i&n&&s++,r&n&&s--,i=i<<1|1,r=r<<1|~(l|i),i&=l}for(o=l;o--;)j[e.charCodeAt(o)]=0;return s})(e,t):((e,t)=>{const l=t.length,a=e.length,n=[],r=[],i=Math.ceil(l/32),s=Math.ceil(a/32);for(let h=0;h<i;h++)r[h]=-1,n[h]=0;let o=0;for(;o<s-1;o++){let i=0,s=-1;const c=32*o,u=Math.min(32,a)+c;for(let t=c;t<u;t++)j[e.charCodeAt(t)]|=1<<t;for(let e=0;e<l;e++){const l=j[t.charCodeAt(e)],a=r[e/32|0]>>>e&1,o=n[e/32|0]>>>e&1,c=l|i,u=((l|o)&s)+s^s|l|o;let d=i|~(u|s),f=s&u;d>>>31^a&&(r[e/32|0]^=1<<e),f>>>31^o&&(n[e/32|0]^=1<<e),d=d<<1|a,f=f<<1|o,s=f|~(c|d),i=d&c}for(let t=c;t<u;t++)j[e.charCodeAt(t)]=0}let c=0,u=-1;const d=32*o,f=Math.min(32,a-d)+d;for(let h=d;h<f;h++)j[e.charCodeAt(h)]|=1<<h;let v=a;for(let h=0;h<l;h++){const e=j[t.charCodeAt(h)],l=r[h/32|0]>>>h&1,i=n[h/32|0]>>>h&1,s=e|c,o=((e|i)&u)+u^u|e|i;let d=c|~(o|u),f=u&o;v+=d>>>a-1&1,v-=f>>>a-1&1,d>>>31^l&&(r[h/32|0]^=1<<h),f>>>31^i&&(n[h/32|0]^=1<<h),d=d<<1|l,f=f<<1|i,u=f|~(s|d),c=d&s}for(let h=d;h<f;h++)j[e.charCodeAt(h)]=0;return v})(e,t)};function L(e,t){const l=null==t?void 0:t.filter((e=>void 0!==e));let a=!1;const n=new RegExp(/[，。！“”/《》？：；「」{}｜\\"$&+,:;=?@#|'<>.^*()%!\-\s]/g),r=e.toLowerCase().replaceAll(n,""),i=null==l?void 0:l.map((e=>e.toString().toLowerCase().replaceAll(n,"")));return null==i||i.forEach((e=>{var t,l;e&&(1-E(t=r,l=e)/Math.max(t.length,l.length)>.66||r.includes(e)||e.includes(r)||e.startsWith(r)||e.endsWith(r)||""===r)&&(a=!0)})),a}function $(e,t,l){return l.filter((l=>t.includes(l[e])))}const z={class:"student-container rounded-small"},I=["src","alt"],M={class:"name-tag"},N=o(e({__name:"StudentShowbox",props:{studentInfo:Object},setup(e){const o=e,c=t(),u=l((()=>c.getLang.replace("zh","cn"))),d=l((()=>{var e;return(null==(e=o.studentInfo)?void 0:e.name[u.value])||""}));return(t,l)=>{var o,c,u;return a(),n("div",z,[r("img",{class:"student-avatar",src:(u=null==(o=e.studentInfo)?void 0:o.id,`/image/avatar_students/${u}.webp`),alt:null==(c=e.studentInfo)?void 0:c.name.cn},null,8,I),r("div",M,i(s(d)),1)])}}}),[["__scopeId","data-v-444a086c"]]),H=e=>(S("data-v-42e59aa0"),e=e(),w(),e),W={key:1,class:"loading"},U={class:"spinner"},R={key:2,id:"student-selector-container"},q={class:"filter-banner"},D=["placeholder"],O={src:"/assets/clear-filter-e675c05c.svg",alt:"Clear all filters"},P=[H((()=>r("img",{src:"/assets/filter-options-ac505d64.svg",alt:"Filter options"},null,-1)))],V={class:"student-filter"},B={class:"filter-group"},G={class:"filter-label"},J=H((()=>r("span",null,"稀有度",-1))),K={class:"filter-options"},Q=["onClick"],X={class:"filter-group"},Y={class:"filter-label"},Z=H((()=>r("span",null,"学校",-1))),ee={class:"filter-options"},te=["onClick"],le={class:"filter-group"},ae={class:"filter-label"},ne=H((()=>r("span",null,"战术作用",-1))),re={class:"filter-options"},ie=["onClick"],se={class:"filter-group"},oe={class:"filter-label"},ce=H((()=>r("span",null,"装甲类型",-1))),ue={class:"filter-options"},de=["onClick"],fe={class:"filter-group"},ve={class:"filter-label"},he=H((()=>r("span",null,"社团",-1))),pe={class:"filter-options"},ge=["onClick"],me={id:"student-list"},ye=o(e({__name:"StudentSelector",setup(e){const o=x(),S=t(),w=_(),j=c(!1),E=c(0),z=l((()=>!/\/archive\/?$/.test(o.path))),I=c(!1),M=c({});T.get("/config/json/students.json",{onDownloadProgress:e=>{E.value=Math.floor(100*(e.loaded||0)/(e.total||1))}}).then((e=>{try{const t=e.data.sort(((e,t)=>e.name.cn.localeCompare(t.name.cn,"zh-Hans-CN",{sensitivity:"accent"})));w.setStudents(t)}catch(t){const l=e.data;w.setStudents(l)}j.value=!0})).catch((e=>{console.log(e),I.value=!0,M.value=e.message,j.value=!0}));const H=l((()=>w.getAllStudents)),ye=l((()=>H.value.map((e=>({id:e.id,allNames:[e.name.cn,e.name.jp,e.name.en,...e.nickname]})))));function be(e,t=!0){const l=[];if(H.value.forEach((t=>{l.includes(t[e])||l.push(t[e])})),t)try{return l.sort(((e,t)=>e.toString().localeCompare(t.toString(),"zh-Hans-CN",{sensitivity:"accent"})))}catch(a){return l}return l}const Ce=[{string:"LightArmor",name:"轻装甲",order:1},{string:"HeavyArmor",name:"重装甲",order:2},{string:"Unarmed",name:"神秘装甲",order:3}];const ke=l((()=>be("rarity",!1))),Se=l((()=>be("club"))),we=l((()=>be("affiliation"))),xe=l((()=>be("type",!1))),Ae=l((()=>be("armorType",!1).sort(((e,t)=>function(e,t){const l=Ce.find((t=>t.string===e))||{name:"0"},a=Ce.find((e=>e.string===t))||{name:"1"};return l.name.localeCompare(a.name,"zh-Hans-CN",{sensitivity:"accent"})}(e,t))))),Te=c(""),Fe=l((()=>({searchString:Te.value,rarity:S.getRarityFilter,club:S.getClubFilter,affiliation:S.getAffiliationFilter,type:S.getTypeFilter,armorType:S.getArmorTypeFilter}))),_e=l((()=>0===Fe.value.rarity.length&&0===Fe.value.club.length&&0===Fe.value.affiliation.length&&0===Fe.value.type.length&&0===Fe.value.armorType.length));function je(e,t){return Fe.value[e].includes(t)?"active":""}function Ee(e,t){Fe.value[e].includes(t)?Fe.value[e]=Fe.value[e].filter((e=>e!==t)):Fe.value[e].push(t),S.setStudentFilters(Fe.value)}const Le=l((()=>function(e,t,l){if(""===e.searchString&&0===e.rarity.length&&0===e.club.length&&0===e.affiliation.length&&0===e.type.length&&0===e.armorType.length)return l.map((e=>e.id));let a=l;if(e.searchString){const n=[];l.forEach((l=>{var a;L(e.searchString,null==(a=t.find((e=>e.id===l.id)))?void 0:a.allNames)&&n.push(l)})),a=n}return 0!==e.rarity.length&&(a=$("rarity",e.rarity,a)),0!==e.club.length&&(a=$("club",e.club,a)),0!==e.affiliation.length&&(a=$("affiliation",e.affiliation,a)),0!==e.type.length&&(a=$("type",e.type,a)),0!==e.armorType.length&&(a=$("armorType",e.armorType,a)),a.map((e=>e.id))}(Fe.value,ye.value,H.value)));function $e(e){e.target.select()}const ze=c(!0);function Ie(){ze.value=window.innerWidth>768}function Me(e){S.clearStudentFilter(e)}return u((()=>{window.innerWidth<=768&&(ze.value=!1),window.addEventListener("resize",Ie)})),d((()=>{window.removeEventListener("resize",Ie)})),(e,t)=>{const l=A("router-link"),c=A("router-view");return a(),n(m,null,[I.value?(a(),f(F,{key:0,"error-message":M.value,"route-path":s(o).path},null,8,["error-message","route-path"])):v("",!0),j.value?v("",!0):(a(),n("div",W,[r("div",U,[r("span",null,i(E.value)+"%",1)])])),j.value&&!s(z)?(a(),n("div",R,[r("div",q,[h(r("input",{type:"text",id:"name-filter",placeholder:Te.value?"":"在学生姓名/黑话内搜索…","onUpdate:modelValue":t[0]||(t[0]=e=>Te.value=e),onFocus:$e,autocomplete:"off"},null,40,D),[[p,Te.value]]),s(_e)?v("",!0):(a(),n("div",{key:0,class:"clear-filter-icon",onClick:t[1]||(t[1]=(...e)=>s(S).clearStudentFilters&&s(S).clearStudentFilters(...e))},[h(r("img",O,null,512),[[g,!s(_e)]])])),r("div",{class:"filter-options-icon-mobile rounded-small",onClick:t[2]||(t[2]=e=>ze.value=!ze.value)},P)]),h(r("div",V,[r("div",B,[r("h2",G,[J,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[3]||(t[3]=e=>Me("rarity"))},null,512),[[g,0!==s(Fe).rarity.length]])]),r("div",K,[(a(!0),n(m,null,y(s(ke),(e=>(a(),n("div",{class:b(["filter-tag rounded-small",je("rarity",e)]),role:"checkbox",key:e,onClick:t=>Ee("rarity",e)}," ★ "+i(e),11,Q)))),128))])]),r("div",X,[r("h2",Y,[Z,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[4]||(t[4]=e=>Me("affiliation"))},null,512),[[g,0!==s(Fe).affiliation.length]])]),r("div",ee,[(a(!0),n(m,null,y(s(we),(e=>(a(),n("div",{class:b(["filter-tag rounded-small",je("affiliation",e)]),role:"checkbox",key:e,onClick:t=>Ee("affiliation",e)},i(e),11,te)))),128))])]),r("div",le,[r("h2",ae,[ne,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[5]||(t[5]=e=>Me("type"))},null,512),[[g,0!==s(Fe).type.length]])]),r("div",re,[(a(!0),n(m,null,y(s(xe),(e=>(a(),n("div",{class:b(["filter-tag tactic-type rounded-small",`${e.toString().toLowerCase()} ${je("type",e)}`]),role:"checkbox",key:e,onClick:t=>Ee("type",e)},i(e),11,ie)))),128))])]),r("div",se,[r("h2",oe,[ce,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[6]||(t[6]=e=>Me("armorType"))},null,512),[[g,0!==s(Fe).armorType.length]])]),r("div",ue,[(a(!0),n(m,null,y(s(Ae),(e=>{var t;return a(),n("div",{class:b(["filter-tag armor-type rounded-small",`${e.toString().toLowerCase()} ${je("armorType",e)}`]),role:"checkbox",key:e,onClick:t=>Ee("armorType",e)},i((null==(t=Ce.find((t=>e===t.string)))?void 0:t.name)||e),11,de)})),128))])]),r("div",fe,[r("h2",ve,[he,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[7]||(t[7]=e=>Me("club"))},null,512),[[g,0!==s(Fe).club.length]])]),r("div",pe,[(a(!0),n(m,null,y(s(Se),(e=>(a(),n("div",{class:b(["filter-tag rounded-small",je("club",e)]),role:"checkbox",key:e,onClick:t=>Ee("club",e)},i(e),11,ge)))),128))])])],512),[[g,ze.value]]),r("div",me,[(a(!0),n(m,null,y(s(H),(e=>h((a(),f(l,{class:"student-showcase rounded-small",key:e.id,to:`/archive/${e.id}/momotalk`},{default:C((()=>[k(N,{"student-info":e},null,8,["student-info"])])),_:2},1032,["to"])),[[g,s(Le).includes(e.id)]]))),128))])])):v("",!0),s(z)?(a(),f(c,{key:3})):v("",!0)],64)}}}),[["__scopeId","data-v-42e59aa0"]]);export{ye as default};
