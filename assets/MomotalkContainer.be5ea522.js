import{u as e,a}from"./students.263e4b98.js";import{d as s,c as t,o as n,a as l,b as o,t as i,e as r,n as d,A as u,p as c,q as g,_ as v,u as p,r as M,h as m,F as I,j as h,k as T,s as C,m as x}from"./index.c90f9be9.js";const k=["onKeydown"],f={class:"section-title"},w={class:"ordered-list"},y={class:"title"},N=[(e=>(c("data-v-aeac5381"),e=e(),g(),e))((()=>o("path",{fill:"#344A6E",d:"M225.9 354.7c-8.1 0-16.2-3.1-22.4-9.3L9.3 151.2c-12.4-12.4-12.4-32.4 0-44.8C21.7 94 41.7 94 54 106.4l171.9 171.9 171.9-171.9c12.4-12.4 32.4-12.4 44.7 0 12.4 12.4 12.4 32.4 0 44.8L248.3 345.4c-6.2 6.2-14.3 9.3-22.4 9.3z"},null,-1)))],G=v(s({__name:"StudentArchiveTitle",props:{title:{type:Object,required:!0},index:{type:Number,required:!1},language:{type:String,required:!0},isActive:{type:Boolean,required:!1}},emits:["clicked"],setup(e,{emit:a}){const s=e;function c(){a("clicked")}const g=t((()=>"zh"===s.language||"cn"===s.language?s.title.TextCn||void 0:"jp"===s.language?s.title.TextJp||void 0:"en"===s.language?s.title.TextEn||void 0:"kr"===s.language?s.title.TextKr||void 0:"th"===s.language?s.title.TextTh||void 0:"tw"===s.language&&s.title.TextTw||void 0)),v=t((()=>s.title.TextCn?s.title.TextCn:s.title.TextJp?s.title.TextJp:s.title.TextEn?s.title.TextEn:s.title.TextKr?s.title.TextKr:s.title.TextTh?s.title.TextTh:s.title.TextTw?s.title.TextTw:void 0));return(a,s)=>{var t;return n(),l("div",{class:"archive-title rounded-small",tabindex:"0",onClick:c,onKeydown:[u(c,["enter"]),u(c,["space"])]},[o("p",f,[o("span",w,i(`${parseInt((null==(t=e.index)?void 0:t.toString())||"0")+1}`.padStart(2,"0")),1),o("span",y,i(r(g)||`!!FallBack: ${r(v)}`),1)]),(n(),l("svg",{class:d(["navigate-arrow",e.isActive?"open":""]),xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 451.8 451.8"},N,2))],40,k)}}}),[["__scopeId","data-v-aeac5381"]]),S=e=>(c("data-v-09d8b6e5"),e=e(),g(),e),b={key:0,class:"student-reply"},P={class:"message-content-wrap rounded-small"},_={key:0},F=["src"],K={key:1,class:"user-reply rounded-small"},E=S((()=>o("div",{class:"user-reply-banner"},[o("span",null,"回复")],-1))),J={class:"select-options flex-vertical"},A=["onClick"],j={key:0,class:"momotalk-unit"},H={class:"favor-schedule-unit rounded-small"},R=S((()=>o("div",{class:"favor-schedule-banner"},[o("span",null,"羁绊事件")],-1))),V={role:"button",class:"favor-schedule-button rounded-small shadow-near"},W=v(s({__name:"MomoTalkComponent",props:{message:Object},emits:["userSelect"],setup(a,{emit:s}){var u,c,g;const v=a,T=p(),C=e(),x=t((()=>T.getLang.replace("cn","zh"))),k=(null==(u=v.message)?void 0:u.CharacterId)||1e4,f=C.getStudentById(k),w=t((()=>(null==f?void 0:f.name[x.value])||"")),y=(null==(c=v.message)?void 0:c.MessageCondition)||"None",N=(null==(g=v.message)?void 0:g.MessageType)||"Text",G=`/image/avatar_students/${k}.webp`,S=M(-1);function W(e){if(e){return`/image/ScenarioImage/${e.split("/").pop()}.png`}return""}function z(e){return e?e.replaceAll(/\[\/?ruby=?.*?]/gi,""):""}function $(e){if(e){let s=function(e,a){let s;return"zh"===e?s=z(a.MessageCN):"jp"===e?s=z(a.MessageJP):"en"===e?s=z(a.MessageEN):"kr"===e?s=z(a.MessageKR):"th"===e?s=z(a.MessageTH):"tw"===e&&(s=z(a.MessageTW)),s||void 0}(x.value,e);return s||`!Fallback:${a=e,a.MessageCN?z(a.MessageCN):a.MessageTW?z(a.MessageTW):a.MessageJP?z(a.MessageJP):a.MessageEN?z(a.MessageEN):a.MessageKR?z(a.MessageKR):a.MessageTH?z(a.MessageTH):"NoFallbackText"}`}var a;return""}return(e,t)=>{var u,c,g,v,p,M;return n(),l(I,null,[o("div",{class:d(["momotalk-unit",(null==(u=a.message)?void 0:u.avatar)||"Answer"===r(y)?"":"condensed"])},["Answer"!==r(y)?(n(),l("div",b,[o("img",{class:d(["student-avatar",(null==(c=a.message)?void 0:c.avatar)?"":"hidden"]),src:G},null,2),o("div",P,["Image"!==r(N)?(n(),l("span",_,i($(a.message)),1)):(n(),l("img",{key:1,src:W(null==(g=a.message)?void 0:g.ImagePath)},null,8,F))])])):m("",!0),"Answer"===r(y)?(n(),l("div",K,[E,o("div",J,[(n(!0),l(I,null,h(null==(p=null==(v=a.message)?void 0:v.options)?void 0:p.content,((e,t)=>(n(),l("div",{role:"button",class:d(["rounded-small shadow-near",t===S.value?"selected":""]),key:t,onClick:n=>{var l,o,i,r;return o=t,i=null==(l=a.message)?void 0:l.Id,r=e.NextGroupId,S.value=o,void s("userSelect",i||0,r)}},i($(e)),11,A)))),128))])])):m("",!0)],2),0!==(null==(M=a.message)?void 0:M.FavorScheduleId)?(n(),l("div",j,[o("div",H,[R,o("div",V," 前往"+i(r(w))+"的羁绊事件 ",1)])])):m("",!0)],64)}}}),[["__scopeId","data-v-09d8b6e5"]]),z={key:0,class:"optionChange"},$={class:"momotalk-main-interface flex-vertical"},q=(e=>(c("data-v-0dec56d0"),e=e(),g(),e))((()=>o("div",{class:"momotalk-banner flex-horizontal center"},[o("svg",{xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",id:"Layer_2_00000033347787382183846980000016369978894466167968_",x:"0",y:"0",viewBox:"0 0 512 477.9"},[o("path",{d:"M101.8 396.4c-53.3 0-98.4 53.8-101.8 79.5 81.4 7.9 196.1-6.8 252.1-65-74.7 13.5-135.9-5.2-150.3-14.5zM281.4 412.5c55.1 73.3 137.7 58.5 230.5 63.3 3.5-42.1-73.2-80.9-103.9-82.2-39.9 28.5-123.3 19.5-126.6 18.9z"}),o("path",{d:"M256.4 0C136.8 45 31.5 151.4 31.5 259.4c0 85 68.4 153.9 195.3 137.3 3.9-.5 7.6-1.1 11.2-1.7-1.1-.4-2.1-.9-2.9-1.3-19.4-9.8-53.4-56.7-39-112.6 1.4 59.3 39.7 102.6 57.1 111 2.7 1.3 11.9 4.6 25.5 6.7 51.9 8 164.9 4.7 187.9-116.7C498.9 111.4 256.4 0 256.4 0z"})]),o("span",null,"MomoTalk")],-1))),B={class:"messages"},L=v(s({__name:"MomotalkViewer",props:{messageGroup:null,content:null},setup(e){const a=e;let s=M(0);const t=M([]);async function r(e,a){var n;if(s.value!=a)return;const l=u(e),o=l[0];if(o){if("Answer"==o.MessageCondition){const l=[],i=u(e),r=(null==(n=i.find((e=>0!==e.FavorScheduleId)))?void 0:n.FavorScheduleId)||0;for(const e of i)l.push({MessageCN:e.MessageCN,MessageJP:e.MessageJP,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW,NextGroupId:e.NextGroupId});if(s.value!=a)return;return t.value.push({avatar:!1,MessageGroupId:o.MessageGroupId,Id:o.Id,CharacterId:o.CharacterId,ConditionValue:0,PreConditionGroupId:0,FavorScheduleId:r,NextGroupId:0,FeedbackTimeMillisec:0,MessageCondition:"Answer",options:{current:-1,content:l},MessageType:"Text",ImagePath:""}),void(await d(1e3))}if(s.value==a){t.value.push({avatar:!0,MessageGroupId:o.MessageGroupId,Id:o.Id,CharacterId:o.CharacterId,ConditionValue:o.ConditionValue,PreConditionGroupId:o.PreConditionGroupId,FavorScheduleId:o.FavorScheduleId,NextGroupId:o.NextGroupId,FeedbackTimeMillisec:o.FeedbackTimeMillisec,MessageCondition:o.MessageCondition,MessageType:o.MessageType,ImagePath:o.ImagePath,MessageJP:o.MessageJP,MessageCN:o.MessageCN,MessageEN:o.MessageEN,MessageKR:o.MessageKR,MessageTH:o.MessageTH,MessageTW:o.MessageTW}),await d(1e3);for(let e of l.slice(1)){if(s.value!=a)return;t.value.push({avatar:!1,MessageGroupId:e.MessageGroupId,Id:e.Id,CharacterId:e.CharacterId,ConditionValue:e.ConditionValue,PreConditionGroupId:e.PreConditionGroupId,FavorScheduleId:e.FavorScheduleId,NextGroupId:e.NextGroupId,FeedbackTimeMillisec:e.FeedbackTimeMillisec,MessageCondition:e.MessageCondition,MessageType:e.MessageType,ImagePath:e.ImagePath,MessageJP:e.MessageJP,MessageCN:e.MessageCN,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW}),await d(1e3)}await r(o.NextGroupId,a)}}}function d(e){return new Promise((a=>setTimeout(a,e)))}function u(e){var s;return null==(s=a.content)?void 0:s.filter((a=>a.MessageGroupId==e))}const c=M(!1);function g(e,a){const n=t.value.findIndex((a=>a.Id===e));t.value=t.value.slice(0,n+1),s.value++,r(a,s.value)}return r(a.content[0].MessageGroupId,0),(a,s)=>(n(),l(I,null,[c.value?(n(),l("div",z)):m("",!0),o("div",null,i(e.messageGroup),1),o("div",$,[q,o("div",B,[(n(!0),l(I,null,h(t.value,((e,a)=>(n(),T(W,{key:a,message:e,onUserSelect:g},null,8,["message"])))),128))])])],64))}}),[["__scopeId","data-v-0dec56d0"]]),O={class:"momotalk-component-container"},U=v(s({__name:"MomotalkContainer",setup(e){const s=p(),o=t((()=>s.getLang)),i=M({CharacterId:0,title:[],content:[],splitMomotalk:[]}),d=M([]),u=C();return a.get(`/config/json/momotalk/${u.params.id}.json`).then((e=>{const a=e.data;i.value.CharacterId=a.CharacterId,i.value.title=a.title,i.value.content=a.content,i.value.splitMomotalk=function(e){const a=[];for(const s of e)0===a.length?a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]}):0===s.ConditionValue?a[a.length-1].splitMomotalkContent.push(s):a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]});return a}(a.content)})),(e,a)=>(n(),l("div",O,[(n(!0),l(I,null,h(i.value.title,((e,a)=>{return n(),l("div",{class:"momotalks-view-container flex-vertical",key:a},[x(G,{onClicked:e=>function(e){d.value.includes(e)?d.value=d.value.filter((a=>a!==e)):d.value.push(e)}(a),title:e,language:r(o),index:a,"is-active":d.value.includes(a)},null,8,["onClicked","title","language","index","is-active"]),d.value.includes(a)?(n(),T(L,{key:0,messageGroup:e.GroupId,content:(s=e.GroupId,null==(t=i.value.splitMomotalk.find((e=>e.FavorScheduleId===s)))?void 0:t.splitMomotalkContent)},null,8,["messageGroup","content"])):m("",!0)]);var s,t})),128))]))}}),[["__scopeId","data-v-e377b47d"]]);export{U as default};
