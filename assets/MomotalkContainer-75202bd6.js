import{a as e,_ as a}from"./axios-adaacd2d.js";import{d as s,c as t,o as n,a as l,b as o,t as r,e as i,n as d,A as u,q as c,s as v,_ as g,u as p,r as m,y as M,i as h,w as I,j as f,F as C,k,p as b,m as T,h as x,l as y,x as w}from"./index-b6a76b7a.js";import{u as N}from"./students-9a7d98c5.js";const F=["onKeydown"],S={class:"section-title"},G=["src"],_={class:"title"},A={class:"ordered-list"},P={class:"navigation-button rounded-small",role:"button",tabindex:"0"},E=[(e=>(c("data-v-e5b00eb8"),e=e(),v(),e))((()=>o("path",{fill:"#fff",d:"M225.9 354.7c-8.1 0-16.2-3.1-22.4-9.3L9.3 151.2c-12.4-12.4-12.4-32.4 0-44.8C21.7 94 41.7 94 54 106.4l171.9 171.9 171.9-171.9c12.4-12.4 32.4-12.4 44.7 0 12.4 12.4 12.4 32.4 0 44.8L248.3 345.4c-6.2 6.2-14.3 9.3-22.4 9.3z"},null,-1)))],R=g(s({__name:"StudentArchiveTitle",props:{avatar:{type:String,required:!1,default:""},title:{type:Object,required:!0},index:{type:Number,required:!1},language:{type:String,required:!0},isActive:{type:Boolean,required:!1}},emits:["clicked"],setup(e,{emit:a}){const s=e;function c(){a("clicked")}const v={cn:"TextCn",zh:"TextCn",tw:"TextTw",en:"TextEn",jp:"TextJp",kr:"TextKr",th:"TextTh"},g=t((()=>Reflect.get(s.title,Reflect.get(v,s.language))));function p(){for(const e in v){const a=Reflect.get(s.title,Reflect.get(v,e));if(a)return a}return"NoFallbackText"}return(a,t)=>{var v;return n(),l("div",{class:"archive-title rounded-medium shadow-farther",tabindex:"0",onClick:c,onKeydown:[u(c,["enter"]),u(c,["space"])]},[o("div",S,[o("img",{src:s.avatar,class:"avatar rounded-small"},null,8,G),o("span",_,r(i(g)||`!!FallBack: ${p()}`),1),o("span",A,r(`${parseInt((null==(v=e.index)?void 0:v.toString())||"0")+1}`.padStart(2,"0")),1)]),o("div",P,[(n(),l("svg",{class:d(["navigation-arrow",e.isActive?"open":""]),xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 451.8 451.8"},E,2))])],40,F)}}}),[["__scopeId","data-v-e5b00eb8"]]),j=e=>(c("data-v-691feb28"),e=e(),v(),e),$={key:0,class:"student-reply"},K={class:"message-content-wrap rounded-small"},V={key:0,class:"typing-indicator"},z=[j((()=>o("span",{class:"dot-1"},"·",-1))),j((()=>o("span",{class:"dot-2"},"·",-1))),j((()=>o("span",{class:"dot-3"},"·",-1)))],J={class:"message-content"},q={key:0},B=["src"],H={key:1,class:"user-reply rounded-small"},W=j((()=>o("div",{class:"user-reply-banner"},[o("span",null,"回复")],-1))),L={class:"select-options flex-vertical"},D=["onClick"],O={key:0,class:"momotalk-unit"},U={class:"favor-schedule-unit rounded-small"},Q=j((()=>o("div",{class:"favor-schedule-banner"},[o("span",null,"羁绊事件")],-1))),X=g(s({__name:"MomoTalkComponent",props:{message:Object},emits:["userSelect"],setup(e,{emit:a}){var s,u,c,v;const g=e,y=p(),w=N(),F=t((()=>y.getLang.replace("zh","cn"))),S=(null==(s=g.message)?void 0:s.CharacterId)||1e4,G=w.getStudentById(S),_=t((()=>(null==G?void 0:G.name[F.value])||"")),A=(null==(u=g.message)?void 0:u.MessageCondition)||"None",P=(null==(c=g.message)?void 0:c.MessageType)||"Text",E=`/image/avatar_students/${S}.webp`,R=m(-1),j=m(!1),X=m(!1),Y=(null==(v=g.message)?void 0:v.FeedbackTimeMillisec)||1e3;function Z(e){if(e){return`/image/ScenarioImage/${e.split("/").pop()}.png`}return""}setTimeout((()=>{j.value=!0}),Y),setTimeout((()=>{X.value=!0}),Y+500);const ee={cn:"MessageCN",zh:"MessageCN",tw:"MessageTW",en:"MessageEN",jp:"MessageJP",kr:"MessageKR",th:"MessageTH"};function ae(e){if(e){let t=(a=F.value,s=e,function(e){return e?e.replaceAll(/\[\/?ruby=?.*?]/gi,""):""}(Reflect.get(s,Reflect.get(ee,a))));return t||`!Fallback:${function(e){for(const a in ee){const s=Reflect.get(e,Reflect.get(ee,a));if(s)return s}return"NoFallbackText"}(e)}`}var a,s;return""}return(s,t)=>{var u,c,v,g,p,m;const y=M("router-link");return n(),l(C,null,[o("div",{class:d(["momotalk-unit",(null==(u=e.message)?void 0:u.avatar)||"Answer"===i(A)?"":"condensed"])},["Answer"!==i(A)?(n(),l("div",$,[o("img",{class:d(["student-avatar",(null==(c=e.message)?void 0:c.avatar)?"":"hidden"]),src:E},null,2),o("div",K,[j.value?h("",!0):(n(),l("div",V,z)),I(o("div",J,["Image"!==i(P)?(n(),l("span",q,r(ae(e.message)),1)):(n(),l("img",{key:1,src:Z(null==(v=e.message)?void 0:v.ImagePath)},null,8,B))],512),[[f,j.value]])])])):h("",!0),"Answer"===i(A)?(n(),l("div",H,[W,o("div",L,[(n(!0),l(C,null,k(null==(p=null==(g=e.message)?void 0:g.options)?void 0:p.content,((s,t)=>(n(),l("div",{role:"button",class:d(["rounded-small shadow-near",t===R.value?"selected":""]),key:t,onClick:n=>{var l,o,r,i;return o=t,r=null==(l=e.message)?void 0:l.Id,i=s.NextGroupId,R.value=o,void a("userSelect",r||0,i)}},r(ae(s)),11,D)))),128))])])):h("",!0)],2),0!==(null==(m=e.message)?void 0:m.FavorScheduleId)&&X.value?(n(),l("div",O,[o("div",U,[Q,b(y,{to:`/archive/${i(S)}/story`,role:"button",class:"favor-schedule-button rounded-small shadow-near"},{default:T((()=>[x(" 前往"+r(i(_))+"的羁绊事件 ",1)])),_:1},8,["to"])])])):h("",!0)],64)}}}),[["__scopeId","data-v-691feb28"]]),Y=e=>(c("data-v-e675aa81"),e=e(),v(),e),Z={class:"momotalk-main-interface flex-vertical"},ee={class:"momotalk-banner flex-horizontal center"},ae=Y((()=>o("svg",{xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",id:"Layer_2_00000033347787382183846980000016369978894466167968_",x:"0",y:"0",viewBox:"0 0 512 477.9"},[o("path",{d:"M101.8 396.4c-53.3 0-98.4 53.8-101.8 79.5 81.4 7.9 196.1-6.8 252.1-65-74.7 13.5-135.9-5.2-150.3-14.5zM281.4 412.5c55.1 73.3 137.7 58.5 230.5 63.3 3.5-42.1-73.2-80.9-103.9-82.2-39.9 28.5-123.3 19.5-126.6 18.9z"}),o("path",{d:"M256.4 0C136.8 45 31.5 151.4 31.5 259.4c0 85 68.4 153.9 195.3 137.3 3.9-.5 7.6-1.1 11.2-1.7-1.1-.4-2.1-.9-2.9-1.3-19.4-9.8-53.4-56.7-39-112.6 1.4 59.3 39.7 102.6 57.1 111 2.7 1.3 11.9 4.6 25.5 6.7 51.9 8 164.9 4.7 187.9-116.7C498.9 111.4 256.4 0 256.4 0z"})],-1))),se={class:"momotalk-title-text"},te=Y((()=>o("span",{class:"title"},"MomoTalk",-1))),ne={class:"credit"},le=Y((()=>o("span",null,"translated by ",-1))),oe={key:0},re=Y((()=>o("a",{href:"https://space.bilibili.com/37507923",target:"_blank"}," 碧蓝档案资讯站 ",-1))),ie={class:"messages"},de=g(s({__name:"MomotalkViewer",props:{messageGroup:Number,translator:{type:String,default:"",required:!1},content:Object},setup(e){const a=e;let s=m(0);const t=m([]);async function i(e,a){var n;if(a!==s.value)return;const l=u(e),o=l[0];if(o){if("Answer"===o.MessageCondition){const l=[],r=u(e),i=(null==(n=r.find((e=>0!==e.FavorScheduleId)))?void 0:n.FavorScheduleId)||0;for(const e of r)l.push({MessageCN:e.MessageCN,MessageJP:e.MessageJP,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW,NextGroupId:e.NextGroupId});if(a!==s.value)return;return t.value.push({avatar:!1,MessageGroupId:o.MessageGroupId,Id:o.Id,CharacterId:o.CharacterId,ConditionValue:0,PreConditionGroupId:0,FavorScheduleId:i,NextGroupId:0,FeedbackTimeMillisec:0,MessageCondition:"Answer",options:{current:-1,content:l},MessageType:"Text",ImagePath:""}),void(await d(-1e3))}if(a===s.value){t.value.push({avatar:!0,MessageGroupId:o.MessageGroupId,Id:o.Id,CharacterId:o.CharacterId,ConditionValue:o.ConditionValue,PreConditionGroupId:o.PreConditionGroupId,FavorScheduleId:o.FavorScheduleId,NextGroupId:o.NextGroupId,FeedbackTimeMillisec:o.FeedbackTimeMillisec,MessageCondition:o.MessageCondition,MessageType:o.MessageType,ImagePath:o.ImagePath,MessageJP:o.MessageJP,MessageCN:o.MessageCN,MessageEN:o.MessageEN,MessageKR:o.MessageKR,MessageTH:o.MessageTH,MessageTW:o.MessageTW}),await d(o.FeedbackTimeMillisec||1500);for(let e of l.slice(1)){if(a!==s.value)return;t.value.push({avatar:!1,MessageGroupId:e.MessageGroupId,Id:e.Id,CharacterId:e.CharacterId,ConditionValue:e.ConditionValue,PreConditionGroupId:e.PreConditionGroupId,FavorScheduleId:e.FavorScheduleId,NextGroupId:e.NextGroupId,FeedbackTimeMillisec:e.FeedbackTimeMillisec,MessageCondition:e.MessageCondition,MessageType:e.MessageType,ImagePath:e.ImagePath,MessageJP:e.MessageJP,MessageCN:e.MessageCN,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW}),await d(e.FeedbackTimeMillisec||1500)}await i(o.NextGroupId,a)}}}function d(e){return new Promise((a=>setTimeout(a,e+1e3)))}function u(e){var s;return null==(s=a.content)?void 0:s.filter((a=>a.MessageGroupId===e))}function c(e,a){const n=t.value.findIndex((a=>a.Id===e));t.value=t.value.slice(0,n+1),s.value++,i(a,s.value)}return i(a.content[0].MessageGroupId,0),(a,s)=>(n(),l("div",Z,[o("div",ee,[ae,o("div",se,[te,o("div",ne,[le,e.translator?(n(),l("span",oe,r(e.translator)+"@",1)):h("",!0),re])])]),o("div",ie,[(n(!0),l(C,null,k(t.value,((e,a)=>(n(),y(X,{key:a,message:e,onUserSelect:c},null,8,["message"])))),128))])]))}}),[["__scopeId","data-v-e675aa81"]]),ue=e=>(c("data-v-53e1b1dd"),e=e(),v(),e),ce={key:0,class:"error-container"},ve=ue((()=>o("img",{src:a,alt:"Network Error"},null,-1))),ge={class:"error-message"},pe=ue((()=>o("p",null,"数据加载失败，请刷新页面重试。",-1))),me=["href"],Me={class:"error-content"},he={class:"momotalk-component-container"},Ie=g(s({__name:"MomotalkContainer",setup(a){const s=p(),d=t((()=>s.getLang)),u=m({CharacterId:0,translate:"",title:[],content:[],splitMomotalk:[]}),c=m([]),v=w();const g=m(!1),M=m("");return e.get(`/config/json/momotalk/${v.params.id}.json`).then((e=>{const a=e.data;u.value.CharacterId=a.CharacterId,u.value.translator=a.translator,u.value.title=a.title,u.value.content=a.content,u.value.splitMomotalk=function(e){const a=[];for(const s of e)0===a.length?a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]}):0===s.ConditionValue?a[a.length-1].splitMomotalkContent.push(s):a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]});return a}(a.content)})).catch((e=>{g.value=!0,M.value=e.message,console.error(e)})),(e,a)=>(n(),l(C,null,[g.value?(n(),l("div",ce,[ve,o("div",ge,[pe,o("p",null,[x(" 如果多次刷新页面仍无效，请 "),o("a",{href:`mailto:mail@blue-archive.io?subject=%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A%EF%BC%88blue-archive.io%EF%BC%89&body=Fetch failed with /config/json/momotalk/${i(v).params.id}.json: %0D%0A%0D%0A${M.value}%0D%0A%0D%0AOrigin: ${i(v).path}`,target:"_blank"},"联系我们",8,me),x("。 ")]),o("p",Me,"Error: "+r(M.value),1)])])):h("",!0),o("div",he,[(n(!0),l(C,null,k(u.value.title,((e,a)=>{return n(),l("div",{class:"momotalks-view-container flex-vertical",key:a},[b(R,{onClicked:e=>function(e){c.value.includes(e)?c.value=c.value.filter((a=>a!==e)):c.value.push(e)}(a),avatar:(o=u.value.CharacterId,`/image/avatar_students/${o}.webp`),title:e,language:i(d),index:a,"is-active":c.value.includes(a)},null,8,["onClicked","avatar","title","language","index","is-active"]),c.value.includes(a)?(n(),y(de,{key:0,messageGroup:e.GroupId,translator:u.value.translator,content:(s=e.GroupId,null==(t=u.value.splitMomotalk.find((e=>e.FavorScheduleId===s)))?void 0:t.splitMomotalkContent)},null,8,["messageGroup","translator","content"])):h("",!0)]);var s,t,o})),128))])],64))}}),[["__scopeId","data-v-53e1b1dd"]]);export{Ie as default};
