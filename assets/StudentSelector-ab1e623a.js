import{d as e,u as t,c as l,o as a,a as n,b as r,t as i,e as s,_ as o,r as c,f as u,g as d,h as f,i as v,w as h,v as p,j as g,F as m,k as y,l as b,n as C,m as k,p as A,q as w,s as S,x,y as F}from"./index-dd163940.js";import{a as E,_ as T}from"./axios-adaacd2d.js";import{u as _}from"./students-74b2ff02.js";const j=new Uint32Array(65536),$=(e,t)=>{if(e.length<t.length){const l=t;t=e,e=l}return 0===t.length?e.length:e.length<=32?((e,t)=>{const l=e.length,a=t.length,n=1<<l-1;let r=-1,i=0,s=l,o=l;for(;o--;)j[e.charCodeAt(o)]|=1<<o;for(o=0;o<a;o++){let e=j[t.charCodeAt(o)];const l=e|i;e|=(e&r)+r^r,i|=~(e|r),r&=e,i&n&&s++,r&n&&s--,i=i<<1|1,r=r<<1|~(l|i),i&=l}for(o=l;o--;)j[e.charCodeAt(o)]=0;return s})(e,t):((e,t)=>{const l=t.length,a=e.length,n=[],r=[],i=Math.ceil(l/32),s=Math.ceil(a/32);for(let h=0;h<i;h++)r[h]=-1,n[h]=0;let o=0;for(;o<s-1;o++){let i=0,s=-1;const c=32*o,u=Math.min(32,a)+c;for(let t=c;t<u;t++)j[e.charCodeAt(t)]|=1<<t;for(let e=0;e<l;e++){const l=j[t.charCodeAt(e)],a=r[e/32|0]>>>e&1,o=n[e/32|0]>>>e&1,c=l|i,u=((l|o)&s)+s^s|l|o;let d=i|~(u|s),f=s&u;d>>>31^a&&(r[e/32|0]^=1<<e),f>>>31^o&&(n[e/32|0]^=1<<e),d=d<<1|a,f=f<<1|o,s=f|~(c|d),i=d&c}for(let t=c;t<u;t++)j[e.charCodeAt(t)]=0}let c=0,u=-1;const d=32*o,f=Math.min(32,a-d)+d;for(let h=d;h<f;h++)j[e.charCodeAt(h)]|=1<<h;let v=a;for(let h=0;h<l;h++){const e=j[t.charCodeAt(h)],l=r[h/32|0]>>>h&1,i=n[h/32|0]>>>h&1,s=e|c,o=((e|i)&u)+u^u|e|i;let d=c|~(o|u),f=u&o;v+=d>>>a-1&1,v-=f>>>a-1&1,d>>>31^l&&(r[h/32|0]^=1<<h),f>>>31^i&&(n[h/32|0]^=1<<h),d=d<<1|l,f=f<<1|i,u=f|~(s|d),c=d&s}for(let h=d;h<f;h++)j[e.charCodeAt(h)]=0;return v})(e,t)};function L(e,t){const l=null==t?void 0:t.filter((e=>void 0!==e));let a=!1;const n=new RegExp(/[，。！“”/《》？：；「」{}｜\\"$&+,:;=?@#|'<>.^*()%!\-\s]/g),r=e.toLowerCase().replaceAll(n,""),i=null==l?void 0:l.map((e=>e.toString().toLowerCase().replaceAll(n,"")));return null==i||i.forEach((e=>{var t,l;e&&(1-$(t=r,l=e)/Math.max(t.length,l.length)>.66||r.includes(e)||e.includes(r)||e.startsWith(r)||e.endsWith(r)||""===r)&&(a=!0)})),a}function z(e,t,l){return l.filter((l=>t.includes(l[e])))}const I={class:"student-container rounded-small"},M=["src","alt"],N={class:"name-tag"},D=o(e({__name:"StudentShowbox",props:{studentInfo:Object},setup(e){const o=e,c=t(),u=l((()=>c.getLang.replace("zh","cn"))),d=l((()=>{var e;return(null==(e=o.studentInfo)?void 0:e.name[u.value])||""}));return(t,l)=>{var o,c,u;return a(),n("div",I,[r("img",{class:"student-avatar",src:(u=null==(o=e.studentInfo)?void 0:o.id,`/image/avatar_students/${u}.webp`),alt:null==(c=e.studentInfo)?void 0:c.name.cn},null,8,M),r("div",N,i(s(d)),1)])}}}),[["__scopeId","data-v-444a086c"]]),H=e=>(w("data-v-98a46347"),e=e(),S(),e),W={key:0,class:"error-container"},U=H((()=>r("img",{src:T,alt:"Network Error"},null,-1))),B={class:"error-message"},O=H((()=>r("p",null,"数据加载失败，请刷新页面重试。",-1))),R=["href"],q={class:"error-content"},P={key:1,class:"loading"},V={class:"spinner"},G={key:2,id:"student-selector-container"},J={class:"filter-banner"},K=["placeholder"],Q={src:"/assets/clear-filter-e675c05c.svg",alt:"Clear all filters"},X=[H((()=>r("img",{src:"/assets/filter-options-ac505d64.svg",alt:"Filter options"},null,-1)))],Y={class:"student-filter"},Z={class:"filter-group"},ee={class:"filter-label"},te=H((()=>r("span",null,"稀有度",-1))),le={class:"filter-options"},ae=["onClick"],ne={class:"filter-group"},re={class:"filter-label"},ie=H((()=>r("span",null,"学校",-1))),se={class:"filter-options"},oe=["onClick"],ce={class:"filter-group"},ue={class:"filter-label"},de=H((()=>r("span",null,"战术作用",-1))),fe={class:"filter-options"},ve=["onClick"],he={class:"filter-group"},pe={class:"filter-label"},ge=H((()=>r("span",null,"装甲类型",-1))),me={class:"filter-options"},ye=["onClick"],be={class:"filter-group"},Ce={class:"filter-label"},ke=H((()=>r("span",null,"社团",-1))),Ae={class:"filter-options"},we=["onClick"],Se={id:"student-list"},xe=o(e({__name:"StudentSelector",setup(e){const o=x(),w=t(),S=_(),T=c(!1),j=c(0),$=l((()=>!/\/archive\/?$/.test(o.path))),I=c(!1),M=c("");E.get("/config/json/students.json",{onDownloadProgress:e=>{j.value=Math.floor(100*(e.loaded||0)/(e.total||1))}}).then((e=>{try{const t=e.data.sort(((e,t)=>e.name.cn.localeCompare(t.name.cn,"zh-Hans-CN",{sensitivity:"accent"})));S.setStudents(t)}catch(t){const l=e.data;S.setStudents(l)}T.value=!0})).catch((e=>{console.log(e),I.value=!0,M.value=e.message,T.value=!0}));const N=l((()=>S.getAllStudents)),H=l((()=>N.value.map((e=>({id:e.id,allNames:[e.name.cn,e.name.jp,e.name.en,...e.nickname]})))));function xe(e,t=!0){const l=[];if(N.value.forEach((t=>{l.includes(t[e])||l.push(t[e])})),t)try{return l.sort(((e,t)=>e.toString().localeCompare(t.toString(),"zh-Hans-CN",{sensitivity:"accent"})))}catch(a){return l}return l}const Fe=[{string:"LightArmor",name:"轻装甲",order:1},{string:"HeavyArmor",name:"重装甲",order:2},{string:"Unarmed",name:"神秘装甲",order:3}];const Ee=l((()=>xe("rarity",!1))),Te=l((()=>xe("club"))),_e=l((()=>xe("affiliation"))),je=l((()=>xe("type",!1))),$e=l((()=>xe("armorType",!1).sort(((e,t)=>function(e,t){const l=Fe.find((t=>t.string===e))||{name:"0"},a=Fe.find((e=>e.string===t))||{name:"1"};return l.name.localeCompare(a.name,"zh-Hans-CN",{sensitivity:"accent"})}(e,t))))),Le=c(""),ze=l((()=>({searchString:Le.value,rarity:w.getRarityFilter,club:w.getClubFilter,affiliation:w.getAffiliationFilter,type:w.getTypeFilter,armorType:w.getArmorTypeFilter}))),Ie=l((()=>0===ze.value.rarity.length&&0===ze.value.club.length&&0===ze.value.affiliation.length&&0===ze.value.type.length&&0===ze.value.armorType.length));function Me(e,t){return ze.value[e].includes(t)?"active":""}function Ne(e,t){ze.value[e].includes(t)?ze.value[e]=ze.value[e].filter((e=>e!==t)):ze.value[e].push(t),w.setStudentFilters(ze.value)}const De=l((()=>function(e,t,l){if(""===e.searchString&&0===e.rarity.length&&0===e.club.length&&0===e.affiliation.length&&0===e.type.length&&0===e.armorType.length)return l.map((e=>e.id));let a=l;if(e.searchString){const n=[];l.forEach((l=>{var a;L(e.searchString,null==(a=t.find((e=>e.id===l.id)))?void 0:a.allNames)&&n.push(l)})),a=n}return 0!==e.rarity.length&&(a=z("rarity",e.rarity,a)),0!==e.club.length&&(a=z("club",e.club,a)),0!==e.affiliation.length&&(a=z("affiliation",e.affiliation,a)),0!==e.type.length&&(a=z("type",e.type,a)),0!==e.armorType.length&&(a=z("armorType",e.armorType,a)),a.map((e=>e.id))}(ze.value,H.value,N.value)));function He(e){e.target.select()}const We=c(!0);function Ue(){We.value=window.innerWidth>768}function Be(e){w.clearStudentFilter(e)}return u((()=>{window.innerWidth<=768&&(We.value=!1),window.addEventListener("resize",Ue)})),d((()=>{window.removeEventListener("resize",Ue)})),(e,t)=>{const l=F("router-link"),c=F("router-view");return a(),n(m,null,[I.value?(a(),n("div",W,[U,r("div",B,[O,r("p",null,[f(" 如果多次刷新页面仍无效，请 "),r("a",{href:`mailto:mail@blue-archive.io?subject=%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A%EF%BC%88blue-archive.io%EF%BC%89&body=Fetch failed with /config/json/students.json: %0D%0A%0D%0A${M.value}%0D%0A%0D%0AOrigin: ${s(o).path}`,target:"_blank"},"联系我们",8,R),f("。 ")]),r("p",q,"Error: "+i(M.value),1)])])):v("",!0),T.value?v("",!0):(a(),n("div",P,[r("div",V,[r("span",null,i(j.value)+"%",1)])])),T.value&&!s($)?(a(),n("div",G,[r("div",J,[h(r("input",{type:"text",id:"name-filter",placeholder:Le.value?"":"在学生姓名/黑话内搜索…","onUpdate:modelValue":t[0]||(t[0]=e=>Le.value=e),onFocus:He,autocomplete:"off"},null,40,K),[[p,Le.value]]),s(Ie)?v("",!0):(a(),n("div",{key:0,class:"clear-filter-icon",onClick:t[1]||(t[1]=(...e)=>s(w).clearStudentFilters&&s(w).clearStudentFilters(...e))},[h(r("img",Q,null,512),[[g,!s(Ie)]])])),r("div",{class:"filter-options-icon-mobile rounded-small",onClick:t[2]||(t[2]=e=>We.value=!We.value)},X)]),h(r("div",Y,[r("div",Z,[r("h2",ee,[te,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[3]||(t[3]=e=>Be("rarity"))},null,512),[[g,0!==s(ze).rarity.length]])]),r("div",le,[(a(!0),n(m,null,y(s(Ee),(e=>(a(),n("div",{class:C(["filter-tag rounded-small",Me("rarity",e)]),role:"checkbox",key:e,onClick:t=>Ne("rarity",e)}," ★ "+i(e),11,ae)))),128))])]),r("div",ne,[r("h2",re,[ie,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[4]||(t[4]=e=>Be("affiliation"))},null,512),[[g,0!==s(ze).affiliation.length]])]),r("div",se,[(a(!0),n(m,null,y(s(_e),(e=>(a(),n("div",{class:C(["filter-tag rounded-small",Me("affiliation",e)]),role:"checkbox",key:e,onClick:t=>Ne("affiliation",e)},i(e),11,oe)))),128))])]),r("div",ce,[r("h2",ue,[de,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[5]||(t[5]=e=>Be("type"))},null,512),[[g,0!==s(ze).type.length]])]),r("div",fe,[(a(!0),n(m,null,y(s(je),(e=>(a(),n("div",{class:C(["filter-tag tactic-type rounded-small",`${e.toString().toLowerCase()} ${Me("type",e)}`]),role:"checkbox",key:e,onClick:t=>Ne("type",e)},i(e),11,ve)))),128))])]),r("div",he,[r("h2",pe,[ge,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[6]||(t[6]=e=>Be("armorType"))},null,512),[[g,0!==s(ze).armorType.length]])]),r("div",me,[(a(!0),n(m,null,y(s($e),(e=>{var t;return a(),n("div",{class:C(["filter-tag armor-type rounded-small",`${e.toString().toLowerCase()} ${Me("armorType",e)}`]),role:"checkbox",key:e,onClick:t=>Ne("armorType",e)},i((null==(t=Fe.find((t=>e===t.string)))?void 0:t.name)||e),11,ye)})),128))])]),r("div",be,[r("h2",Ce,[ke,h(r("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[7]||(t[7]=e=>Be("club"))},null,512),[[g,0!==s(ze).club.length]])]),r("div",Ae,[(a(!0),n(m,null,y(s(Te),(e=>(a(),n("div",{class:C(["filter-tag rounded-small",Me("club",e)]),role:"checkbox",key:e,onClick:t=>Ne("club",e)},i(e),11,we)))),128))])])],512),[[g,We.value]]),r("div",Se,[(a(!0),n(m,null,y(s(N),(e=>h((a(),b(l,{class:"student-showcase rounded-small",key:e.id,to:`/archive/${e.id}/momotalk`},{default:k((()=>[A(D,{"student-info":e},null,8,["student-info"])])),_:2},1032,["to"])),[[g,s(De).includes(e.id)]]))),128))])])):v("",!0),s($)?(a(),b(c,{key:3})):v("",!0)],64)}}}),[["__scopeId","data-v-98a46347"]]);export{xe as default};
