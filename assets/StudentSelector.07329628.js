import{d as e,u as t,c as l,a as n,t as a,b as r,s as i,_ as s,r as o,o as c,e as u,f as d,g as f,w as h,v,h as p,F as g,i as m,j as y,k as b,n as C,l as k,m as w,p as S,q as x,x as A,y as T}from"./index.9488eae2.js";import{u as F,a as _}from"./students.40169704.js";const L=new Uint32Array(65536),$=(e,t)=>{if(e.length<t.length){const l=t;t=e,e=l}return 0===t.length?e.length:e.length<=32?((e,t)=>{const l=e.length,n=t.length,a=1<<l-1;let r=-1,i=0,s=l,o=l;for(;o--;)L[e.charCodeAt(o)]|=1<<o;for(o=0;o<n;o++){let e=L[t.charCodeAt(o)];const l=e|i;e|=(e&r)+r^r,i|=~(e|r),r&=e,i&a&&s++,r&a&&s--,i=i<<1|1,r=r<<1|~(l|i),i&=l}for(o=l;o--;)L[e.charCodeAt(o)]=0;return s})(e,t):((e,t)=>{const l=t.length,n=e.length,a=[],r=[],i=Math.ceil(l/32),s=Math.ceil(n/32);for(let v=0;v<i;v++)r[v]=-1,a[v]=0;let o=0;for(;o<s-1;o++){let i=0,s=-1;const c=32*o,u=Math.min(32,n)+c;for(let t=c;t<u;t++)L[e.charCodeAt(t)]|=1<<t;for(let e=0;e<l;e++){const l=L[t.charCodeAt(e)],n=r[e/32|0]>>>e&1,o=a[e/32|0]>>>e&1,c=l|i,u=((l|o)&s)+s^s|l|o;let d=i|~(u|s),f=s&u;d>>>31^n&&(r[e/32|0]^=1<<e),f>>>31^o&&(a[e/32|0]^=1<<e),d=d<<1|n,f=f<<1|o,s=f|~(c|d),i=d&c}for(let t=c;t<u;t++)L[e.charCodeAt(t)]=0}let c=0,u=-1;const d=32*o,f=Math.min(32,n-d)+d;for(let v=d;v<f;v++)L[e.charCodeAt(v)]|=1<<v;let h=n;for(let v=0;v<l;v++){const e=L[t.charCodeAt(v)],l=r[v/32|0]>>>v&1,i=a[v/32|0]>>>v&1,s=e|c,o=((e|i)&u)+u^u|e|i;let d=c|~(o|u),f=u&o;h+=d>>>n-1&1,h-=f>>>n-1&1,d>>>31^l&&(r[v/32|0]^=1<<v),f>>>31^i&&(a[v/32|0]^=1<<v),d=d<<1|l,f=f<<1|i,u=f|~(s|d),c=d&s}for(let v=d;v<f;v++)L[e.charCodeAt(v)]=0;return h})(e,t)};function j(e,t){const l=null==t?void 0:t.filter((e=>void 0!==e));console.log(l);let n=!1;const a=new RegExp(/[，。！“”/《》？：；「」{}｜\\"$&+,:;=?@#|'<>.^*()%!\-\s]/g),r=e.toLowerCase().replaceAll(a,""),i=null==l?void 0:l.map((e=>(console.log(e),e.toString().toLowerCase().replaceAll(a,""))));return null==i||i.forEach((e=>{var t,l;e&&(1-$(t=r,l=e)/Math.max(t.length,l.length)>.66||r.includes(e)||e.includes(r)||e.startsWith(r)||e.endsWith(r)||""===r)&&(n=!0)})),n}function z(e,t,l){return l.filter((l=>t.includes(l[e])))}const E=["src","alt"],I={class:"name-tag"},M=s(e({__name:"StudentShowbox",props:{studentInfo:Object},setup(e){const s=e,o=t(),c=l((()=>o.getLang.replace("cn","zh"))),u=l((()=>{var e;return(null==(e=s.studentInfo)?void 0:e.name[c.value])||""}));return(t,l)=>{return l[0]||(i(-1),l[0]=n("div",{class:"student-container rounded-small"},[n("img",{class:"student-avatar",src:(s=e.studentInfo.id,`/image/avatar_students/${s}.webp`),alt:e.studentInfo.name.cn},null,8,E),n("div",I,a(r(u)),1)]),i(1),l[0]);var s}}}),[["__scopeId","data-v-f75c86b7"]]),N=e=>(S("data-v-4489ec5f"),e=e(),x(),e),H={key:0,class:"loading"},W={class:"spinner"},U={key:1,id:"student-selector-container"},R={class:"filter-banner"},q=["placeholder"],D={src:"/assets/clear-filter.e675c05c.svg",alt:"Clear all filters"},O=[N((()=>n("img",{src:"/assets/filter-options.ac505d64.svg",alt:"Filter options"},null,-1)))],P={class:"student-filter"},V={class:"filter-group"},B={class:"filter-label"},G=N((()=>n("span",null,"稀有度",-1))),J={class:"filter-options"},K=["onClick"],Q={class:"filter-group"},X={class:"filter-label"},Y=N((()=>n("span",null,"学校",-1))),Z={class:"filter-options"},ee=["onClick"],te={class:"filter-group"},le={class:"filter-label"},ne=N((()=>n("span",null,"战术作用",-1))),ae={class:"filter-options"},re=["onClick"],ie={class:"filter-group"},se={class:"filter-label"},oe=N((()=>n("span",null,"装甲类型",-1))),ce={class:"filter-options"},ue=["onClick"],de={class:"filter-group"},fe={class:"filter-label"},he=N((()=>n("span",null,"社团",-1))),ve={class:"filter-options"},pe=["onClick"],ge={id:"student-list"},me=s(e({__name:"StudentSelector",setup(e){const i=A(),s=t(),S=F(),x=o(!1),L=o(0),$=l((()=>!/\/archive\/?$/.test(i.path)));_.get("/config/json/students.json",{onDownloadProgress:e=>{L.value=Math.floor(100*(e.loaded||0)/(e.total||1))}}).then((e=>{try{const t=e.data.sort(((e,t)=>e.name.cn.localeCompare(t.name.cn,"zh-Hans-CN",{sensitivity:"accent"})));S.setStudents(t)}catch(t){const l=e.data;S.setStudents(l)}x.value=!0})).catch((e=>{console.log(e)}));const E=l((()=>S.getAllStudents)),I=l((()=>E.value.map((e=>({id:e.id,allNames:[e.name.cn,e.name.jp,e.name.en,...e.nickname]})))));function N(e,t=!0){const l=[];if(E.value.forEach((t=>{l.includes(t[e])||l.push(t[e])})),t)try{return l.sort(((e,t)=>e.toString().localeCompare(t.toString(),"zh-Hans-CN",{sensitivity:"accent"})))}catch(n){return l}return l}const me=[{string:"LightArmor",name:"轻装甲",order:1},{string:"HeavyArmor",name:"重装甲",order:2},{string:"Unarmed",name:"神秘装甲",order:3}];const ye=l((()=>N("rarity",!1))),be=l((()=>N("club"))),Ce=l((()=>N("affiliation"))),ke=l((()=>N("type",!1))),we=l((()=>N("armorType",!1).sort(((e,t)=>function(e,t){const l=me.find((t=>t.string===e))||{name:"0"},n=me.find((e=>e.string===t))||{name:"1"};return l.name.localeCompare(n.name,"zh-Hans-CN",{sensitivity:"accent"})}(e,t))))),Se=o(""),xe=l((()=>({searchString:Se.value,rarity:s.getRarityFilter,club:s.getClubFilter,affiliation:s.getAffiliationFilter,type:s.getTypeFilter,armorType:s.getArmorTypeFilter}))),Ae=l((()=>0===xe.value.rarity.length&&0===xe.value.club.length&&0===xe.value.affiliation.length&&0===xe.value.type.length&&0===xe.value.armorType.length));function Te(e,t){return xe.value[e].includes(t)?"active":""}function Fe(e,t){xe.value[e].includes(t)?xe.value[e]=xe.value[e].filter((e=>e!==t)):xe.value[e].push(t),s.setStudentFilters(xe.value)}const _e=l((()=>function(e,t,l){if(""===e.searchString&&0===e.rarity.length&&0===e.club.length&&0===e.affiliation.length&&0===e.type.length&&0===e.armorType.length)return l.map((e=>e.id));let n=l;if(e.searchString){const a=[];l.forEach((l=>{var n;j(e.searchString,null==(n=t.find((e=>e.id===l.id)))?void 0:n.allNames)&&a.push(l)})),n=a}return 0!==e.rarity.length&&(n=z("rarity",e.rarity,n)),0!==e.club.length&&(n=z("club",e.club,n)),0!==e.affiliation.length&&(n=z("affiliation",e.affiliation,n)),0!==e.type.length&&(n=z("type",e.type,n)),0!==e.armorType.length&&(n=z("armorType",e.armorType,n)),n.map((e=>e.id))}(xe.value,I.value,E.value)));function Le(e){e.target.select()}const $e=o(!0);function je(){$e.value=window.innerWidth>768}function ze(e){s.clearStudentFilter(e)}return c((()=>{window.innerWidth<=768&&($e.value=!1),window.addEventListener("resize",je)})),u((()=>{window.removeEventListener("resize",je)})),(e,t)=>{const l=T("router-link"),i=T("router-view");return b(),d(g,null,[x.value?f("",!0):(b(),d("div",H,[n("div",W,[n("span",null,a(L.value)+"%",1)])])),x.value&&!r($)?(b(),d("div",U,[n("div",R,[h(n("input",{type:"text",id:"name-filter",placeholder:Se.value?"":"在学生姓名/黑话内搜索…","onUpdate:modelValue":t[0]||(t[0]=e=>Se.value=e),onFocus:Le,autocomplete:"off"},null,40,q),[[v,Se.value]]),r(Ae)?f("",!0):(b(),d("div",{key:0,class:"clear-filter-icon",onClick:t[1]||(t[1]=(...e)=>r(s).clearStudentFilters&&r(s).clearStudentFilters(...e))},[h(n("img",D,null,512),[[p,!r(Ae)]])])),n("div",{class:"filter-options-icon-mobile rounded-small",onClick:t[2]||(t[2]=e=>$e.value=!$e.value)},O)]),h(n("div",P,[n("div",V,[n("h2",B,[G,h(n("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[3]||(t[3]=e=>ze("rarity"))},null,512),[[p,0!==r(xe).rarity.length]])]),n("div",J,[(b(!0),d(g,null,m(r(ye),(e=>(b(),d("div",{class:C(["filter-tag rounded-small",Te("rarity",e)]),role:"checkbox",key:e,onClick:t=>Fe("rarity",e)}," ★ "+a(e),11,K)))),128))])]),n("div",Q,[n("h2",X,[Y,h(n("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[4]||(t[4]=e=>ze("affiliation"))},null,512),[[p,0!==r(xe).affiliation.length]])]),n("div",Z,[(b(!0),d(g,null,m(r(Ce),(e=>(b(),d("div",{class:C(["filter-tag rounded-small",Te("affiliation",e)]),role:"checkbox",key:e,onClick:t=>Fe("affiliation",e)},a(e),11,ee)))),128))])]),n("div",te,[n("h2",le,[ne,h(n("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[5]||(t[5]=e=>ze("type"))},null,512),[[p,0!==r(xe).type.length]])]),n("div",ae,[(b(!0),d(g,null,m(r(ke),(e=>(b(),d("div",{class:C(["filter-tag tactic-type rounded-small",`${e.toString().toLowerCase()} ${Te("type",e)}`]),role:"checkbox",key:e,onClick:t=>Fe("type",e)},a(e),11,re)))),128))])]),n("div",ie,[n("h2",se,[oe,h(n("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[6]||(t[6]=e=>ze("armorType"))},null,512),[[p,0!==r(xe).armorType.length]])]),n("div",ce,[(b(!0),d(g,null,m(r(we),(e=>{var t;return b(),d("div",{class:C(["filter-tag armor-type rounded-small",`${e.toString().toLowerCase()} ${Te("armorType",e)}`]),role:"checkbox",key:e,onClick:t=>Fe("armorType",e)},a((null==(t=me.find((t=>e===t.string)))?void 0:t.name)||e),11,ue)})),128))])]),n("div",de,[n("h2",fe,[he,h(n("span",{class:"clear-filter-button",role:"button",tabindex:"0",onClick:t[7]||(t[7]=e=>ze("club"))},null,512),[[p,0!==r(xe).club.length]])]),n("div",ve,[(b(!0),d(g,null,m(r(be),(e=>(b(),d("div",{class:C(["filter-tag rounded-small",Te("club",e)]),role:"checkbox",key:e,onClick:t=>Fe("club",e)},a(e),11,pe)))),128))])])],512),[[p,$e.value]]),n("div",ge,[(b(!0),d(g,null,m(r(E),(e=>h((b(),y(l,{class:"student-showcase rounded-small",key:e.id,to:`/archive/${e.id}/momotalk`},{default:k((()=>[w(M,{"student-info":e},null,8,["student-info"])])),_:2},1032,["to"])),[[p,r(_e).includes(e.id)]]))),128))])])):f("",!0),r($)?(b(),y(i,{key:2})):f("",!0)],64)}}}),[["__scopeId","data-v-4489ec5f"]]);export{me as default};
