import{_ as e,c as t,s as a,a as l,t as r,n,u as i,b as o,r as s,w as c,d as u,o as d,e as f,f as h,g as p,v,F as m,h as y,i as g,j as k,k as b,l as C,p as A,m as S}from"./index.49270332.js";import{a as w}from"./axios.be23cc29.js";const x=new Uint32Array(65536),T=(e,t)=>{if(e.length<t.length){const a=t;t=e,e=a}return 0===t.length?e.length:e.length<=32?((e,t)=>{const a=e.length,l=t.length,r=1<<a-1;let n=-1,i=0,o=a,s=a;for(;s--;)x[e.charCodeAt(s)]|=1<<s;for(s=0;s<l;s++){let e=x[t.charCodeAt(s)];const a=e|i;e|=(e&n)+n^n,i|=~(e|n),n&=e,i&r&&o++,n&r&&o--,i=i<<1|1,n=n<<1|~(a|i),i&=a}for(s=a;s--;)x[e.charCodeAt(s)]=0;return o})(e,t):((e,t)=>{const a=t.length,l=e.length,r=[],n=[],i=Math.ceil(a/32),o=Math.ceil(l/32);for(let p=0;p<i;p++)n[p]=-1,r[p]=0;let s=0;for(;s<o-1;s++){let i=0,o=-1;const c=32*s,u=Math.min(32,l)+c;for(let t=c;t<u;t++)x[e.charCodeAt(t)]|=1<<t;for(let e=0;e<a;e++){const a=x[t.charCodeAt(e)],l=n[e/32|0]>>>e&1,s=r[e/32|0]>>>e&1,c=a|i,u=((a|s)&o)+o^o|a|s;let d=i|~(u|o),f=o&u;d>>>31^l&&(n[e/32|0]^=1<<e),f>>>31^s&&(r[e/32|0]^=1<<e),d=d<<1|l,f=f<<1|s,o=f|~(c|d),i=d&c}for(let t=c;t<u;t++)x[e.charCodeAt(t)]=0}let c=0,u=-1;const d=32*s,f=Math.min(32,l-d)+d;for(let p=d;p<f;p++)x[e.charCodeAt(p)]|=1<<p;let h=l;for(let p=0;p<a;p++){const e=x[t.charCodeAt(p)],a=n[p/32|0]>>>p&1,i=r[p/32|0]>>>p&1,o=e|c,s=((e|i)&u)+u^u|e|i;let d=c|~(s|u),f=u&s;h+=d>>>l-1&1,h-=f>>>l-1&1,d>>>31^a&&(n[p/32|0]^=1<<p),f>>>31^i&&(r[p/32|0]^=1<<p),d=d<<1|a,f=f<<1|i,u=f|~(o|d),c=d&o}for(let p=d;p<f;p++)x[e.charCodeAt(p)]=0;return h})(e,t)};function _(e,t){let a=!1;const l=new RegExp(/[，。！“”/《》？：；「」{}｜\\"$&+,:;=?@#|'<>.^*()%!\-\s]/g),r=e.toLowerCase().replaceAll(l,"");return t.map((e=>e.toString().toLowerCase().replaceAll(l,""))).forEach((e=>{var t,l;e&&(1-T(t=r,l=e)/Math.max(t.length,l.length)>.7||r.includes(e)||e.includes(r)||e.startsWith(r)||e.endsWith(r)||""===r)&&(a=!0)})),a}function I(e,t,a){return a.filter((a=>t.includes(a[e])))}const j=["src","alt"],$={class:"name-tag"},M=e({__name:"StudentShowbox",props:{studentInfo:{type:Object,required:!0,default:()=>({id:0,familyName:{cn:"",jp:"",en:""},name:{cn:"",jp:"",en:""},nickname:[],rarity:1,club:"",affiliation:"",type:"Main",armorType:"LightArmor",weapon:"AR",availability:{momotalk:!1,story:!1}})}},setup(e){const o=e;const s=t((()=>!(!o.studentInfo.availability.momotalk&&!o.studentInfo.availability.story)));return(t,o)=>{return o[0]||(a(-1),o[0]=l("div",{class:n(["student-container",i(s)?"":"unavailable"])},[l("img",{class:"student-avatar",src:(c=e.studentInfo.id,`/image/avatar_students/${c}.webp`),alt:e.studentInfo.name.cn},null,8,j),l("div",$,r(e.studentInfo.name.cn),1)],2),a(1),o[0]);var c}}},[["__scopeId","data-v-52e53d53"]]),N=e=>(A("data-v-3927250f"),e=e(),S(),e),L={key:0,class:"loading"},E={class:"spinner"},F={key:1,id:"student-selector-container"},H=["placeholder"],O={id:"student-filter"},U={class:"filter-group"},z=N((()=>l("h2",{class:"filter-label"},"稀有度",-1))),J={class:"filter-options"},R=["onClick"],W={class:"filter-group"},q=N((()=>l("h2",{class:"filter-label"},"学校",-1))),D={class:"filter-options"},P=["onClick"],V={class:"filter-group"},B=N((()=>l("h2",{class:"filter-label"},"战术作用",-1))),G={class:"filter-options"},K=["onClick"],Q={class:"filter-group"},X=N((()=>l("h2",{class:"filter-label"},"装甲类型",-1))),Y={class:"filter-options"},Z=["onClick"],ee={class:"filter-group"},te=N((()=>l("h2",{class:"filter-label"},"社团",-1))),ae={class:"filter-options"},le=["onClick"],re={id:"student-list"},ne=e({__name:"StudentSelector",setup(e){const a=o(),A=s(!1),S=s([]),x=s(0),T=s(!1);T.value=!/\/archive\/?$/.test(a.path),w.get("/config/json/students.json",{onDownloadProgress:e=>{x.value=Math.floor(100*e.loaded/e.total)}}).then((e=>{try{S.value=e.data.sort(((e,t)=>e.name.cn.localeCompare(t.name.cn,"zh-Hans-CN",{sensitivity:"accent"})))}catch(t){S.value=e.data}A.value=!0})).catch((e=>{console.log(e)})),c((()=>a.path),(e=>{T.value=!/\/archive\/?$/.test(e)}));const j=t((()=>S.value.map((e=>({id:e.id,allNames:[e.name.cn,e.name.jp,e.name.en,...e.nickname]})))));function $(e,t=!0){const a=[];if(S.value.forEach((t=>{a.includes(t[e])||a.push(t[e])})),t)try{return a.sort(((e,t)=>e.localeCompare(t,"zh-Hans-CN",{sensitivity:"accent"})))}catch(l){return a}return a}const N={LightArmor:{name:"轻装甲",order:1},HeavyArmor:{name:"重装甲",order:2},Unarmed:{name:"神秘装甲",order:3}};function ne(e,t){return N[e].order-N[t].order||-1}const ie=t((()=>$("rarity",!1))),oe=t((()=>$("club"))),se=t((()=>$("affiliation"))),ce=t((()=>$("type",!1))),ue=t((()=>$("armorType",!1).sort(ne))),de=s(""),fe=s({searchString:de,rarity:[],club:[],affiliation:[],type:[],armorType:[]}),he=JSON.parse(localStorage.getItem("appliedFilters"));function pe(e,t){return fe.value[e].includes(t)?"active":""}function ve(e,t){fe.value[e].includes(t)?fe.value[e]=fe.value[e].filter((e=>e!==t)):fe.value[e].push(t)}he&&(fe.value.searchString=he.searchString||"",fe.value.rarity=he.rarity||[],fe.value.club=he.club||[],fe.value.affiliation=he.affiliation||[],fe.value.type=he.type||[],fe.value.armorType=he.armorType||[]);const me=t((()=>(localStorage.setItem("appliedFilters",JSON.stringify(fe.value)),function(e,t,a){if(""===e.searchString&&0===e.rarity.length&&0===e.club.length&&0===e.affiliation.length&&0===e.type.length&&0===e.armorType.length)return a.map((e=>e.id));let l=a;if(e.searchString){const r=[];a.forEach((a=>{_(e.searchString,t.find((e=>e.id===a.id)).allNames)&&r.push(a)})),l=r}return 0!==e.rarity.length&&(l=I("rarity",e.rarity,l)),0!==e.club.length&&(l=I("club",e.club,l)),0!==e.affiliation.length&&(l=I("affiliation",e.affiliation,l)),0!==e.type.length&&(l=I("type",e.type,l)),0!==e.armorType.length&&(l=I("armorType",e.armorType,l)),l.map((e=>e.id))}(fe.value,j.value,S.value))));return(e,t)=>{const a=u("router-link"),o=u("router-view");return d(),f(m,null,[A.value?h("",!0):(d(),f("div",L,[l("div",E,[l("span",null,r(x.value)+"%",1)])])),A.value&&!T.value?(d(),f("div",F,[p(l("input",{type:"text",id:"name-filter",placeholder:de.value?"":"在学生姓名/黑话内搜索…","onUpdate:modelValue":t[0]||(t[0]=e=>de.value=e),onFocus:t[1]||(t[1]=e=>e.target.select()),autocomplete:"off"},null,40,H),[[v,de.value]]),l("div",O,[l("div",U,[z,l("div",J,[(d(!0),f(m,null,y(i(ie),(e=>(d(),f("div",{class:n(["filter-tag",pe("rarity",e)]),role:"checkbox",key:e,onClick:t=>ve("rarity",e)}," ★ "+r(e),11,R)))),128))])]),l("div",W,[q,l("div",D,[(d(!0),f(m,null,y(i(se),(e=>(d(),f("div",{class:n(["filter-tag",pe("affiliation",e)]),role:"checkbox",key:e,onClick:t=>ve("affiliation",e)},r(e),11,P)))),128))])]),l("div",V,[B,l("div",G,[(d(!0),f(m,null,y(i(ce),(e=>(d(),f("div",{class:n(["filter-tag tactic-type",`${e.toLowerCase()} ${pe("type",e)}`]),role:"checkbox",key:e,onClick:t=>ve("type",e)},r(e),11,K)))),128))])]),l("div",Q,[X,l("div",Y,[(d(!0),f(m,null,y(i(ue),(e=>(d(),f("div",{class:n(["filter-tag armor-type",`${e.toLowerCase()} ${pe("armorType",e)}`]),role:"checkbox",key:e,onClick:t=>ve("armorType",e)},r(N[e].name||e),11,Z)))),128))])]),l("div",ee,[te,l("div",ae,[(d(!0),f(m,null,y(i(oe),(e=>(d(),f("div",{class:n(["filter-tag",pe("club",e)]),role:"checkbox",key:e,onClick:t=>ve("club",e)},r(e),11,le)))),128))])])]),l("div",re,[(d(!0),f(m,null,y(S.value,(e=>p((d(),g(a,{class:"student-showcase",key:e.id,to:`/archive/${e.id}/momotalk`,onClick:t[2]||(t[2]=e=>T.value=!0)},{default:b((()=>[C(M,{"student-info":e},null,8,["student-info"])])),_:2},1032,["to"])),[[k,i(me).includes(e.id)]]))),128))])])):h("",!0),T.value?(d(),g(o,{key:2})):h("",!0)],64)}}},[["__scopeId","data-v-3927250f"]]);export{ne as default};
