import{a as e}from"./axios.2e5862c3.js";import{d as a,c as s,o as t,a as n,b as l,t as o,e as r,n as i,A as d,p as u,q as c,_ as g,u as v,r as p,h as m,w as M,i as I,F as h,j as f,k as C,s as k,m as T}from"./index.a28ccd47.js";import{u as x}from"./students.2fad2fe0.js";const b=["onKeydown"],w={class:"section-title"},y={class:"ordered-list"},N={class:"title"},G=[(e=>(u("data-v-62c311fa"),e=e(),c(),e))((()=>l("path",{fill:"#344A6E",d:"M225.9 354.7c-8.1 0-16.2-3.1-22.4-9.3L9.3 151.2c-12.4-12.4-12.4-32.4 0-44.8C21.7 94 41.7 94 54 106.4l171.9 171.9 171.9-171.9c12.4-12.4 32.4-12.4 44.7 0 12.4 12.4 12.4 32.4 0 44.8L248.3 345.4c-6.2 6.2-14.3 9.3-22.4 9.3z"},null,-1)))],S=g(a({__name:"StudentArchiveTitle",props:{title:{type:Object,required:!0},index:{type:Number,required:!1},language:{type:String,required:!0},isActive:{type:Boolean,required:!1}},emits:["clicked"],setup(e,{emit:a}){const u=e;function c(){a("clicked")}const g={zh:"TextCn",tw:"TextTw",en:"TextEn",jp:"TextJp",kr:"TextKr",th:"TextTh"},v=s((()=>Reflect.get(u.title,Reflect.get(g,u.language))));function p(){for(const e in g){const a=Reflect.get(u.title,Reflect.get(g,e));if(a)return a}return"NoFallbackText"}return(a,s)=>{var u;return t(),n("div",{class:"archive-title rounded-small shadow-farther",tabindex:"0",onClick:c,onKeydown:[d(c,["enter"]),d(c,["space"])]},[l("p",w,[l("span",y,o(`${parseInt((null==(u=e.index)?void 0:u.toString())||"0")+1}`.padStart(2,"0")),1),l("span",N,o(r(v)||`!!FallBack: ${p()}`),1)]),(t(),n("svg",{class:i(["navigate-arrow",e.isActive?"open":""]),xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 451.8 451.8"},G,2))],40,b)}}}),[["__scopeId","data-v-62c311fa"]]),F=e=>(u("data-v-0961b327"),e=e(),c(),e),_={key:0,class:"student-reply"},P={class:"message-content-wrap rounded-small"},R={key:0,class:"typing-indicator"},j=[F((()=>l("span",{class:"dot-1"},"·",-1))),F((()=>l("span",{class:"dot-2"},"·",-1))),F((()=>l("span",{class:"dot-3"},"·",-1)))],A={class:"message-content"},K={key:0},E=["src"],V={key:1,class:"user-reply rounded-small"},z=F((()=>l("div",{class:"user-reply-banner"},[l("span",null,"回复")],-1))),J={class:"select-options flex-vertical"},H=["onClick"],W={key:0,class:"momotalk-unit"},q={class:"favor-schedule-unit rounded-small"},$=F((()=>l("div",{class:"favor-schedule-banner"},[l("span",null,"羁绊事件")],-1))),B={role:"button",class:"favor-schedule-button rounded-small shadow-near"},L=g(a({__name:"MomoTalkComponent",props:{message:Object},emits:["userSelect"],setup(e,{emit:a}){var d,u,c,g;const C=e,k=v(),T=x(),b=s((()=>k.getLang.replace("cn","zh"))),w=(null==(d=C.message)?void 0:d.CharacterId)||1e4,y=T.getStudentById(w),N=s((()=>(null==y?void 0:y.name[b.value])||"")),G=(null==(u=C.message)?void 0:u.MessageCondition)||"None",S=(null==(c=C.message)?void 0:c.MessageType)||"Text",F=`/image/avatar_students/${w}.webp`,L=p(-1),O=p(!1),U=p(!1),D=(null==(g=C.message)?void 0:g.FeedbackTimeMillisec)||1e3;function Q(e){if(e){return`/image/ScenarioImage/${e.split("/").pop()}.png`}return""}setTimeout((()=>{O.value=!0}),D),setTimeout((()=>{U.value=!0}),D+500);const X={zh:"MessageCN",tw:"MessageTW",en:"MessageEN",jp:"MessageJP",kr:"MessageKR",th:"MessageTH"};function Y(e){if(e){let t=(a=b.value,s=e,function(e){return e?e.replaceAll(/\[\/?ruby=?.*?]/gi,""):""}(Reflect.get(s,Reflect.get(X,a))));return t||`!Fallback:${function(e){for(const a in X){const s=Reflect.get(e,Reflect.get(X,a));if(s)return s}return"NoFallbackText"}(e)}`}var a,s;return""}return(s,d)=>{var u,c,g,v,p,C;return t(),n(h,null,[l("div",{class:i(["momotalk-unit",(null==(u=e.message)?void 0:u.avatar)||"Answer"===r(G)?"":"condensed"])},["Answer"!==r(G)?(t(),n("div",_,[l("img",{class:i(["student-avatar",(null==(c=e.message)?void 0:c.avatar)?"":"hidden"]),src:F},null,2),l("div",P,[O.value?m("",!0):(t(),n("div",R,j)),M(l("div",A,["Image"!==r(S)?(t(),n("span",K,o(Y(e.message)),1)):(t(),n("img",{key:1,src:Q(null==(g=e.message)?void 0:g.ImagePath)},null,8,E))],512),[[I,O.value]])])])):m("",!0),"Answer"===r(G)?(t(),n("div",V,[z,l("div",J,[(t(!0),n(h,null,f(null==(p=null==(v=e.message)?void 0:v.options)?void 0:p.content,((s,l)=>(t(),n("div",{role:"button",class:i(["rounded-small shadow-near",l===L.value?"selected":""]),key:l,onClick:t=>{var n,o,r,i;return o=l,r=null==(n=e.message)?void 0:n.Id,i=s.NextGroupId,L.value=o,void a("userSelect",r||0,i)}},o(Y(s)),11,H)))),128))])])):m("",!0)],2),0!==(null==(C=e.message)?void 0:C.FavorScheduleId)&&U.value?(t(),n("div",W,[l("div",q,[$,l("div",B," 前往"+o(r(N))+"的羁绊事件 ",1)])])):m("",!0)],64)}}}),[["__scopeId","data-v-0961b327"]]),O=e=>(u("data-v-b5608335"),e=e(),c(),e),U={class:"momotalk-main-interface flex-vertical"},D={class:"momotalk-banner flex-horizontal center"},Q=O((()=>l("svg",{xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",id:"Layer_2_00000033347787382183846980000016369978894466167968_",x:"0",y:"0",viewBox:"0 0 512 477.9"},[l("path",{d:"M101.8 396.4c-53.3 0-98.4 53.8-101.8 79.5 81.4 7.9 196.1-6.8 252.1-65-74.7 13.5-135.9-5.2-150.3-14.5zM281.4 412.5c55.1 73.3 137.7 58.5 230.5 63.3 3.5-42.1-73.2-80.9-103.9-82.2-39.9 28.5-123.3 19.5-126.6 18.9z"}),l("path",{d:"M256.4 0C136.8 45 31.5 151.4 31.5 259.4c0 85 68.4 153.9 195.3 137.3 3.9-.5 7.6-1.1 11.2-1.7-1.1-.4-2.1-.9-2.9-1.3-19.4-9.8-53.4-56.7-39-112.6 1.4 59.3 39.7 102.6 57.1 111 2.7 1.3 11.9 4.6 25.5 6.7 51.9 8 164.9 4.7 187.9-116.7C498.9 111.4 256.4 0 256.4 0z"})],-1))),X={class:"momotalk-title-text"},Y=O((()=>l("span",{class:"title"},"MomoTalk",-1))),Z={class:"credit"},ee=O((()=>l("span",null,"translated by ",-1))),ae={key:0},se=O((()=>l("a",{href:"https://space.bilibili.com/37507923",target:"_blank"}," 碧蓝档案资讯站 ",-1))),te={class:"messages"},ne=g(a({__name:"MomotalkViewer",props:{messageGroup:Number,translate:{type:String,default:"",required:!1},content:Object},setup(e){const a=e;let s=p(0);const r=p([]);async function i(e,a){var t;if(a!==s.value)return;const n=u(e),l=n[0];if(l){if("Answer"===l.MessageCondition){const n=[],o=u(e),i=(null==(t=o.find((e=>0!==e.FavorScheduleId)))?void 0:t.FavorScheduleId)||0;for(const e of o)n.push({MessageCN:e.MessageCN,MessageJP:e.MessageJP,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW,NextGroupId:e.NextGroupId});if(a!==s.value)return;return r.value.push({avatar:!1,MessageGroupId:l.MessageGroupId,Id:l.Id,CharacterId:l.CharacterId,ConditionValue:0,PreConditionGroupId:0,FavorScheduleId:i,NextGroupId:0,FeedbackTimeMillisec:0,MessageCondition:"Answer",options:{current:-1,content:n},MessageType:"Text",ImagePath:""}),void(await d(-1e3))}if(a===s.value){r.value.push({avatar:!0,MessageGroupId:l.MessageGroupId,Id:l.Id,CharacterId:l.CharacterId,ConditionValue:l.ConditionValue,PreConditionGroupId:l.PreConditionGroupId,FavorScheduleId:l.FavorScheduleId,NextGroupId:l.NextGroupId,FeedbackTimeMillisec:l.FeedbackTimeMillisec,MessageCondition:l.MessageCondition,MessageType:l.MessageType,ImagePath:l.ImagePath,MessageJP:l.MessageJP,MessageCN:l.MessageCN,MessageEN:l.MessageEN,MessageKR:l.MessageKR,MessageTH:l.MessageTH,MessageTW:l.MessageTW}),await d(l.FeedbackTimeMillisec||1500);for(let e of n.slice(1)){if(a!==s.value)return;r.value.push({avatar:!1,MessageGroupId:e.MessageGroupId,Id:e.Id,CharacterId:e.CharacterId,ConditionValue:e.ConditionValue,PreConditionGroupId:e.PreConditionGroupId,FavorScheduleId:e.FavorScheduleId,NextGroupId:e.NextGroupId,FeedbackTimeMillisec:e.FeedbackTimeMillisec,MessageCondition:e.MessageCondition,MessageType:e.MessageType,ImagePath:e.ImagePath,MessageJP:e.MessageJP,MessageCN:e.MessageCN,MessageEN:e.MessageEN,MessageKR:e.MessageKR,MessageTH:e.MessageTH,MessageTW:e.MessageTW}),await d(e.FeedbackTimeMillisec||1500)}await i(l.NextGroupId,a)}}}function d(e){return new Promise((a=>setTimeout(a,e+1e3)))}function u(e){var s;return null==(s=a.content)?void 0:s.filter((a=>a.MessageGroupId===e))}function c(e,a){const t=r.value.findIndex((a=>a.Id===e));r.value=r.value.slice(0,t+1),s.value++,i(a,s.value)}return i(a.content[0].MessageGroupId,0),(a,s)=>(t(),n("div",U,[l("div",D,[Q,l("div",X,[Y,l("div",Z,[ee,e.translate?(t(),n("span",ae,o(e.translate)+"@",1)):m("",!0),se])])]),l("div",te,[(t(!0),n(h,null,f(r.value,((e,a)=>(t(),C(L,{key:a,message:e,onUserSelect:c},null,8,["message"])))),128))])]))}}),[["__scopeId","data-v-b5608335"]]),le={class:"momotalk-component-container"},oe=g(a({__name:"MomotalkContainer",setup(a){const l=v(),o=s((()=>l.getLang)),i=p({CharacterId:0,translate:"",title:[],content:[],splitMomotalk:[]}),d=p([]),u=k();return e.get(`/config/json/momotalk/${u.params.id}.json`).then((e=>{const a=e.data;i.value.CharacterId=a.CharacterId,i.value.translate=a.translate,i.value.title=a.title,i.value.content=a.content,i.value.splitMomotalk=function(e){const a=[];for(const s of e)0===a.length?a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]}):0===s.ConditionValue?a[a.length-1].splitMomotalkContent.push(s):a.push({FavorScheduleId:parseInt(s.CharacterId.toString()+s.ConditionValue.toString().padStart(2,"0")),splitMomotalkContent:[s]});return a}(a.content)})),(e,a)=>(t(),n("div",le,[(t(!0),n(h,null,f(i.value.title,((e,a)=>{return t(),n("div",{class:"momotalks-view-container flex-vertical",key:a},[T(S,{onClicked:e=>function(e){d.value.includes(e)?d.value=d.value.filter((a=>a!==e)):d.value.push(e)}(a),title:e,language:r(o),index:a,"is-active":d.value.includes(a)},null,8,["onClicked","title","language","index","is-active"]),d.value.includes(a)?(t(),C(ne,{key:0,messageGroup:e.GroupId,translate:i.value.translate,content:(s=e.GroupId,null==(l=i.value.splitMomotalk.find((e=>e.FavorScheduleId===s)))?void 0:l.splitMomotalkContent)},null,8,["messageGroup","translate","content"])):m("",!0)]);var s,l})),128))]))}}),[["__scopeId","data-v-c6038edb"]]);export{oe as default};
